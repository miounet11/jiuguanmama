---
name: scenario-worldinfo-system
description: TavernAI Plus情景剧本与世界信息系统 - 智能知识库增强AI角色扮演体验
status: backlog
created: 2025-09-22T12:39:34Z
---

# PRD: 情景剧本与世界信息系统

## Executive Summary

TavernAI Plus情景剧本与世界信息系统是一个智能知识库功能，旨在通过动态注入背景信息来增强AI角色扮演的沉浸感和连贯性。该系统借鉴SillyTavern的World Info机制，提供完整的剧本管理、智能关键词触发和上下文优化功能，让AI角色更好地融入设定的世界观中。

**核心价值主张：** 通过智能化的世界信息管理，让每一次对话都拥有丰富的背景设定，显著提升AI角色扮演的质量和用户体验。

## Problem Statement

### 当前痛点
1. **缺乏世界观一致性：** AI角色在对话中难以保持世界设定的一致性，容易产生与背景设定冲突的回复
2. **背景信息匮乏：** 现有系统无法为AI提供丰富的世界背景信息，导致对话内容单调和重复
3. **多角色对话混乱：** 多角色聊天时缺乏共享的世界观，容易产生设定冲突
4. **用户创作负担重：** 用户需要在每次对话中重复描述背景信息，缺乏可复用的知识库
5. **社区资源孤立：** 优秀的世界设定难以分享和复用，社区创作力未得到充分利用

### 为什么现在很重要
- **AI能力提升：** 现代AI模型具备更强的上下文理解能力，能更好地利用结构化的世界信息
- **用户需求升级：** 用户对AI角色扮演的质量要求越来越高，期望更加沉浸的体验
- **社区生态发展：** TavernAI Plus需要建立完整的内容生态，世界信息是重要组成部分
- **竞争优势建立：** 智能的世界信息系统将成为平台的核心竞争优势

## User Stories

### 主要用户角色

#### 1. 内容创作者 (Content Creator)
**特征：** 热爱创作，希望构建完整的虚拟世界设定
**目标：** 创建丰富的世界背景，提升角色扮演质量
**痛点：** 缺乏系统化的工具管理复杂的世界设定

#### 2. 轻度用户 (Casual User)
**特征：** 偶尔使用AI角色扮演，希望简单易用
**目标：** 快速获得高质量的对话体验
**痛点：** 不想花费大量时间配置复杂设定

#### 3. 社区爱好者 (Community Enthusiast)
**特征：** 活跃于社区，喜欢分享和发现优质内容
**目标：** 分享自己的创作，发现他人的优秀设定
**痛点：** 缺乏便捷的分享和发现机制

### 详细用户旅程

#### 旅程1：创作者创建完整世界设定
1. **创建剧本：** 用户在剧本管理界面创建新的世界设定"中世纪奇幻王国"
2. **添加条目：** 分类添加角色、地点、物品、事件等信息条目
3. **设置关键词：** 为每个条目配置触发关键词和优先级
4. **关联角色：** 将剧本绑定到相关的AI角色上
5. **测试验证：** 在对话中测试世界信息的触发效果
6. **迭代优化：** 根据对话效果调整条目内容和触发规则

#### 旅程2：用户快速开始角色对话
1. **选择角色：** 用户在角色列表中选择一个已绑定世界设定的角色
2. **自动加载：** 系统自动加载角色关联的世界信息剧本
3. **开始对话：** 用户发送消息，AI基于世界信息生成符合设定的回复
4. **动态触发：** 对话中的关键词自动触发相关世界信息注入
5. **保持一致：** AI在整个对话过程中保持世界观的一致性

#### 旅程3：社区分享与发现
1. **导出剧本：** 创作者将优质剧本导出为标准格式
2. **分享社区：** 将剧本发布到社区或第三方平台
3. **发现内容：** 其他用户发现并下载感兴趣的剧本
4. **导入使用：** 将剧本导入到自己的TavernAI Plus中
5. **个性化调整：** 根据个人喜好调整剧本内容

## Requirements

### Functional Requirements

#### 1. 剧本库管理系统
**FR-1.1 剧本CRUD操作**
- 创建、编辑、删除、查看剧本
- 支持剧本版本控制和历史记录
- 剧本模板系统（现代都市、奇幻、科幻等）
- 批量操作支持（复制、合并、拆分）

**FR-1.2 剧本组织结构**
- 层级化分类：角色/地点/事件/物品/概念
- 标签化管理：自定义标签，支持多标签筛选
- 搜索功能：关键词搜索、标签过滤、高级查询
- 收藏夹功能：个人收藏和快速访问

#### 2. 世界信息条目管理
**FR-2.1 条目基础功能**
- 条目增删改查操作
- 支持Markdown格式的富文本内容
- 结构化数据支持（JSON格式属性存储）
- 条目间的引用和关联关系

**FR-2.2 关键词触发系统**
- 主要关键词：精确匹配、模糊匹配、正则表达式支持
- 可选过滤器：AND ANY、AND ALL、NOT ANY、NOT ALL逻辑
- 区分大小写配置和整词匹配选项
- 关键词权重和评分机制

**FR-2.3 条目高级配置**
- 插入位置控制：角色定义前后、示例消息前后、指定深度
- 优先级和排序：数值优先级、插入顺序控制
- 概率触发：随机事件支持，概率百分比配置
- 条目状态：常驻、关键词触发、禁用状态

#### 3. 智能激活机制
**FR-3.1 递归扫描系统**
- 条目间关联激活：一个条目触发其他相关条目
- 递归深度控制：防止无限循环，设置最大递归层级
- 激活策略配置：优先包含、权重随机、评分优选

**FR-3.2 上下文管理**
- Token预算控制：设置世界信息的最大token占用
- 扫描深度配置：控制历史消息的扫描范围
- 最小激活数量：确保足够的背景信息注入
- 动态长度调整：根据对话长度智能调整注入量

#### 4. 角色剧本关联
**FR-4.1 关联管理**
- 一对一关联：角色绑定专属剧本
- 一对多关联：角色绑定多个剧本，设置优先级
- 全局剧本：所有对话可用的通用世界信息
- 临时激活：对话中动态启用/禁用特定剧本

**FR-4.2 继承策略**
- 角色优先：角色专属剧本优先于全局剧本
- 均匀排序：所有剧本按优先级统一排序
- 分层注入：不同层级的信息分别注入

#### 5. 导入导出功能
**FR-5.1 格式兼容**
- SillyTavern World Info格式完全兼容
- JSON/YAML标准格式支持
- 自定义格式：TavernAI Plus增强格式
- 批量操作：多剧本打包导入导出

**FR-5.2 数据迁移**
- 从SillyTavern迁移现有World Info数据
- 导入时的冲突检测和解决
- 数据完整性验证和错误报告
- 增量更新和合并功能

### Non-Functional Requirements

#### 1. 性能要求
**NFR-1.1 响应时间**
- 关键词匹配延迟 < 100ms
- 世界信息注入延迟 < 200ms
- 剧本加载时间 < 1s
- 大型剧本（1000+条目）处理时间 < 2s

**NFR-1.2 并发处理**
- 支持100+并发用户同时使用世界信息功能
- 支持10+用户同时编辑同一剧本（未来功能）
- 数据库查询优化，支持复杂关键词匹配

#### 2. 可用性要求
**NFR-2.1 用户界面**
- 直观的剧本管理界面，新用户5分钟内上手
- 响应式设计，支持桌面和移动端
- 拖拽式条目管理，可视化关联关系
- 实时预览功能，编辑时即时查看效果

**NFR-2.2 学习成本**
- 提供完整的使用教程和示例
- 智能提示和操作指导
- 错误信息友好，提供解决建议
- 支持快捷键操作，提升高级用户效率

#### 3. 可扩展性要求
**NFR-3.1 数据规模**
- 单个剧本支持10,000+条目
- 用户可创建1,000+个剧本
- 系统总计支持1,000,000+条目存储
- 关键词索引优化，支持复杂查询

**NFR-3.2 功能扩展**
- 插件化架构，支持第三方扩展
- API接口完整，支持外部系统集成
- 模块化设计，便于功能增删
- 向前兼容，保证数据格式演进

#### 4. 安全性要求
**NFR-4.1 数据安全**
- 用户剧本数据隔离，防止越权访问
- 敏感信息加密存储
- 操作日志记录，支持安全审计
- 数据备份和恢复机制

**NFR-4.2 内容安全**
- 内容审核机制，防止有害信息
- 用户举报功能，社区自治
- 版权保护，防止盗用他人创作
- 隐私保护，个人剧本可见性控制

## Success Criteria

### 核心指标 (Core KPIs)

#### 1. 功能采用率
- **目标：** 60%+的活跃用户使用世界信息功能
- **测量：** 30天内创建或使用过剧本的用户占比
- **基线：** 当前0%（新功能）

#### 2. 内容创作质量
- **目标：** 平均每个剧本包含50+条目
- **测量：** 所有剧本的条目数中位数
- **基线：** 参考SillyTavern社区数据

#### 3. 对话质量提升
- **目标：** 使用世界信息的对话获得20%+更高的用户满意度
- **测量：** 对话评分对比（有/无世界信息）
- **基线：** 当前对话平均评分

#### 4. 社区生态发展
- **目标：** 月新增共享剧本100+个
- **测量：** 每月导出分享的剧本数量
- **基线：** 0个（新功能）

### 用户体验指标 (UX KPIs)

#### 1. 易用性指标
- **新用户完成度：** 90%+用户能在10分钟内创建第一个剧本
- **错误率：** 用户操作错误率 < 5%
- **帮助文档使用率：** < 30%用户需要查看帮助文档

#### 2. 功能价值指标
- **重复使用率：** 80%+用户会重复使用创建的剧本
- **推荐率：** 70%+用户愿意向他人推荐世界信息功能
- **平均使用深度：** 用户平均使用5+个高级功能

#### 3. 性能体验指标
- **响应时间满意度：** 95%+用户认为系统响应及时
- **稳定性指标：** 99%+功能可用时间
- **加载体验：** 90%+操作在2秒内完成

### 商业价值指标 (Business KPIs)

#### 1. 用户留存提升
- **目标：** 使用世界信息功能的用户7日留存率提升15%
- **测量：** 新用户7日留存率对比
- **价值：** 提升用户黏性，降低获客成本

#### 2. 平台活跃度增长
- **目标：** 世界信息功能贡献20%+的用户活跃时长增长
- **测量：** 用户日均使用时长增长
- **价值：** 提升平台价值，增加商业化机会

#### 3. 社区价值创造
- **目标：** 世界信息相关内容获得30%+的社区互动
- **测量：** 点赞、评论、分享等互动数据
- **价值：** 构建内容生态，形成网络效应

## Constraints & Assumptions

### 技术约束 (Technical Constraints)

#### 1. 现有架构限制
- **数据库架构：** 需要在现有Prisma schema基础上扩展，保持向后兼容
- **API接口设计：** 遵循现有RESTful API规范，保持接口一致性
- **前端技术栈：** 基于Vue 3 + Element Plus，复用现有组件库
- **性能预算：** 世界信息处理不能显著影响现有API响应时间

#### 2. 集成复杂度
- **AI模型集成：** 需要适配多种AI模型的prompt格式差异
- **WebSocket集成：** 实时对话中的世界信息注入需要复杂的状态管理
- **缓存策略：** 大量条目和复杂匹配规则需要高效的缓存机制
- **数据同步：** 多用户环境下的数据一致性保证

#### 3. 扩展性考虑
- **数据量增长：** 系统需要支持大规模数据存储和查询
- **功能演进：** 预留接口扩展能力，支持未来功能增强
- **第三方集成：** 考虑与其他AI平台的数据互通需求
- **移动端适配：** 确保功能在移动端的可用性

### 资源约束 (Resource Constraints)

#### 1. 开发资源
- **开发时间：** Phase 1 MVP需要在3个月内完成
- **团队规模：** 2名全栈开发工程师 + 1名UI/UX设计师
- **技术债务：** 需要在不增加技术债务的前提下实现功能
- **测试覆盖：** 保证新功能有完整的单元测试和集成测试覆盖

#### 2. 运营资源
- **服务器成本：** 世界信息处理不能显著增加服务器成本
- **存储成本：** 大量文本数据存储需要成本优化策略
- **带宽消耗：** 实时数据传输需要考虑带宽成本
- **维护成本：** 功能需要具备良好的可维护性

#### 3. 用户支持
- **文档编写：** 需要完整的用户文档和开发者文档
- **社区支持：** 需要社区管理员培训和支持
- **用户反馈：** 建立用户反馈收集和处理机制
- **问题解决：** 快速响应用户问题和bug修复

### 假设条件 (Key Assumptions)

#### 1. 用户行为假设
- **学习意愿：** 用户愿意花费时间学习世界信息功能
- **创作动机：** 有足够的用户有创作世界设定的动机
- **分享文化：** 社区具备分享优质内容的文化氛围
- **质量追求：** 用户重视AI对话的质量提升

#### 2. 技术假设
- **AI模型能力：** 现有AI模型能有效利用注入的世界信息
- **性能表现：** 复杂的关键词匹配不会显著影响系统性能
- **数据一致性：** 现有数据库架构能支持复杂的关联查询
- **扩展能力：** 当前技术架构能支持功能的长期演进

#### 3. 市场假设
- **需求真实性：** 市场确实存在对高质量AI角色扮演的需求
- **竞争环境：** 竞争对手短期内不会推出类似功能
- **用户增长：** 平台用户数量将持续增长
- **商业价值：** 世界信息功能能带来实际的商业价值

#### 4. 运营假设
- **内容质量：** 用户创作的内容质量整体较高
- **社区自治：** 社区能够有效自我管理内容质量
- **技术支持：** 有足够的技术资源支持功能长期运营
- **法律合规：** 用户生成内容符合相关法律法规

## Out of Scope

### Phase 1 明确不包含的功能

#### 1. 高级AI功能
- **语义匹配：** 基于embedding的语义相似度匹配
- **智能推荐：** AI驱动的剧本和角色匹配推荐
- **自动生成：** AI自动生成世界信息条目
- **情感分析：** 基于对话情感动态调整世界信息

#### 2. 多媒体支持
- **图片集成：** 世界信息条目中的图片支持
- **音频内容：** 背景音乐和音效集成
- **视频资源：** 剧情视频片段支持
- **3D可视化：** 世界地图和场景3D展示

#### 3. 高级协作功能
- **实时协作：** 多用户同时编辑同一剧本
- **版本控制：** Git式的分支合并功能
- **权限管理：** 复杂的角色权限和访问控制
- **工作流程：** 内容审核和发布工作流

#### 4. 高级分析功能
- **使用统计：** 详细的世界信息使用分析
- **效果评估：** 世界信息对对话质量的量化分析
- **A/B测试：** 不同世界信息策略的效果对比
- **用户画像：** 基于使用行为的用户分析

#### 5. 第三方集成
- **其他平台：** 与Character.AI、ChatGPT等平台的集成
- **游戏引擎：** 与Unity、Unreal等游戏引擎的数据互通
- **内容管理系统：** 与Notion、Obsidian等知识管理工具集成
- **社交平台：** 与Discord、Twitter等社交平台的分享功能

### 未来可能考虑的功能

#### 1. Phase 2 扩展功能
- 语义匹配和智能推荐
- 基础多媒体支持（图片）
- 简单的协作编辑功能
- 基础数据分析和统计

#### 2. Phase 3 高级功能
- 完整的多媒体支持
- 高级协作和权限管理
- 深度数据分析和AI增强
- 第三方平台集成

#### 3. 长期愿景功能
- AI驱动的内容自动生成
- 沉浸式3D世界展示
- 企业级协作和管理功能
- 完整的内容生态系统

### 明确边界说明

#### 1. 与现有功能的边界
- **不替代角色系统：** 世界信息是角色的增强，不是替代
- **不改变对话引擎：** 在现有对话流程基础上增强，不重构核心逻辑
- **不影响现有API：** 保持现有API的向后兼容性
- **不改变用户数据：** 不修改现有用户和角色数据结构

#### 2. 与第三方服务的边界
- **不依赖外部服务：** 核心功能不依赖第三方API服务
- **不存储敏感数据：** 不处理用户的敏感个人信息
- **不提供付费服务：** Phase 1不涉及付费功能
- **不承担内容责任：** 平台提供工具，用户对内容负责

## Dependencies

### 内部依赖 (Internal Dependencies)

#### 1. 现有系统模块
**依赖组件：**
- **用户认证系统：** 需要用户登录状态和权限验证
- **角色管理系统：** 角色与剧本的关联关系管理
- **对话引擎：** prompt构建时的世界信息注入
- **数据库层：** Prisma ORM和数据库schema扩展

**关键依赖关系：**
- 用户系统 → 剧本所有权和访问控制
- 角色系统 → 角色剧本关联和继承策略
- 对话系统 → 实时世界信息注入和上下文管理
- API层 → RESTful接口和WebSocket事件处理

#### 2. 技术基础设施
**前端依赖：**
- Vue 3生态系统：Composition API、响应式系统
- Element Plus组件库：表单、表格、对话框等UI组件
- Vue Router：剧本管理页面的路由配置
- Pinia状态管理：世界信息状态的全局管理

**后端依赖：**
- Express.js框架：API路由和中间件支持
- Prisma ORM：数据库模型定义和查询生成
- Socket.IO：实时对话中的世界信息同步
- JWT认证：用户身份验证和授权

#### 3. 数据存储依赖
**数据库schema变更：**
- 新增剧本相关数据表：Scenario、WorldInfoEntry、ScenarioEntry
- 扩展现有用户表：添加剧本偏好设置
- 扩展角色表：添加关联剧本字段
- 新增关联表：用户收藏、剧本评分等

**数据迁移需求：**
- 需要数据库迁移脚本支持
- 现有数据的向后兼容性保证
- 开发/生产环境的数据同步策略

### 外部依赖 (External Dependencies)

#### 1. AI模型适配
**API兼容性：**
- OpenAI API：prompt格式适配，上下文长度管理
- Anthropic Claude：system message和user message格式
- Google AI：Gemini Pro的特殊格式要求
- 其他模型：统一的prompt构建接口

**prompt工程需求：**
- 不同模型的最佳实践研究
- 世界信息注入位置的优化
- Token使用量的精确控制
- 模型响应质量的评估方法

#### 2. 第三方工具集成
**开发工具：**
- TypeScript编译器：类型定义和编译支持
- ESLint/Prettier：代码质量和格式化
- Jest测试框架：单元测试和集成测试
- Docker容器：开发和部署环境一致性

**构建和部署：**
- Turbo monorepo：多包管理和构建优化
- Vite构建工具：前端资源打包和优化
- PM2进程管理：生产环境服务管理
- Nginx反向代理：静态资源和API代理

#### 3. 兼容性要求
**SillyTavern兼容：**
- World Info JSON格式的完全支持
- 关键词匹配逻辑的一致性实现
- 导入导出功能的数据完整性
- 高级功能的向下兼容策略

**浏览器兼容：**
- 现代浏览器支持：Chrome 90+、Firefox 90+、Safari 14+
- 移动端浏览器：iOS Safari、Android Chrome
- 响应式设计：不同屏幕尺寸的适配
- 性能优化：大数据量的前端处理优化

### 风险依赖管理

#### 1. 高风险依赖
**AI API稳定性：**
- **风险：** AI服务商API变更或服务中断
- **缓解：** 多模型支持，降级策略，本地缓存
- **监控：** API调用成功率和响应时间监控

**数据库性能：**
- **风险：** 复杂查询导致数据库性能问题
- **缓解：** 查询优化，索引策略，读写分离
- **监控：** 数据库查询性能和资源使用监控

#### 2. 中等风险依赖
**第三方库更新：**
- **风险：** 依赖库的breaking changes
- **缓解：** 版本锁定，测试覆盖，渐进式升级
- **监控：** 依赖库安全漏洞和更新通知

**用户数据迁移：**
- **风险：** 数据迁移过程中的数据丢失或损坏
- **缓解：** 完整的备份策略，分阶段迁移，回滚机制
- **监控：** 数据完整性检查和异常监控

#### 3. 低风险依赖
**UI组件库：**
- **风险：** Element Plus组件的兼容性问题
- **缓解：** 组件封装，自定义样式，备选方案
- **监控：** 前端错误监控和用户反馈

**开发工具链：**
- **风险：** 构建工具的配置变更或bug
- **缓解：** 配置版本控制，多环境测试，备用方案
- **监控：** 构建成功率和部署流程监控

---

*本PRD文档基于详细的用户需求分析创建，涵盖了情景剧本与世界信息系统的完整功能规范。文档遵循产品管理最佳实践，为开发团队提供了清晰的实施指导和成功标准。*