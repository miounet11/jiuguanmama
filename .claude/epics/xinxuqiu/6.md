---
type: task
epic: xinxuqiu
title: 社区市场重构
description: 重新设计角色市场界面，采用Instagram风格的卡片展示，实现多维度筛选系统和丰富的社交互动功能
priority: high
status: todo
assignee: claude
estimated_hours: 20
actual_hours: 0
created: 2025-09-19T08:33:11Z
updated: 2025-09-19T08:50:02Z
depends_on: ["001"]
parallel: []
tags: ["ui", "marketplace", "frontend", "social"]
---

# 社区市场重构

## 概述

完全重构角色市场界面，从传统的列表展示升级为现代化的社交媒体风格。实现Instagram式的卡片布局、智能的多维筛选系统、丰富的社交互动功能和个性化推荐算法。

## 技术规格

### 1. Instagram风格卡片设计
- **瀑布流布局**：Masonry风格的响应式卡片排列
- **高质量预览**：角色头像、名称、描述预览
- **悬停效果**：平滑的阴影和缩放动画
- **快速预览**：hover显示详细信息，无需跳转

### 2. 多维筛选系统
- **分类筛选**：角色类型、风格、语言、难度等
- **标签云**：热门标签动态展示
- **智能搜索**：支持角色名称、描述、标签模糊搜索
- **高级筛选**：价格范围、评分区间、创建时间等

### 3. 社交互动功能
- **点赞收藏**：一键点赞和收藏角色
- **评分系统**：五星评分和文字评价
- **分享功能**：社交媒体分享，生成分享链接
- **关注作者**：关注优秀角色创作者

### 4. 个性化推荐
- **基于历史**：根据用户浏览和收藏历史推荐
- **相似推荐**：基于角色特征的相似性推荐
- **热门趋势**：展示当前热门和新上架角色
- **个性化首页**：为每个用户定制的推荐页面

## 实现文件

### 前端组件
- `apps/web/src/components/Marketplace/CharacterCard.vue` - 角色卡片组件
- `apps/web/src/components/Marketplace/FilterPanel.vue` - 筛选面板组件
- `apps/web/src/components/Marketplace/SearchBar.vue` - 智能搜索栏
- `apps/web/src/components/Marketplace/SocialActions.vue` - 社交互动组件

### 页面组件
- `apps/web/src/views/Marketplace.vue` - 市场主页面
- `apps/web/src/views/CharacterDetail.vue` - 角色详情页
- `apps/web/src/views/CreatorProfile.vue` - 创作者主页
- `apps/web/src/views/MyFavorites.vue` - 我的收藏页

### 样式文件
- `apps/web/src/styles/components/character-cards.scss` - 卡片样式
- `apps/web/src/styles/components/filter-panel.scss` - 筛选面板样式
- `apps/web/src/styles/layouts/marketplace.scss` - 市场布局样式

### 状态管理
- `apps/web/src/stores/marketplace.ts` - 市场状态管理
- `apps/web/src/stores/favorites.ts` - 收藏状态管理
- `apps/web/src/stores/recommendations.ts` - 推荐系统状态

### 后端API扩展
- `apps/api/src/routes/marketplace.ts` - 市场API路由扩展
- `apps/api/src/services/recommendationEngine.ts` - 推荐引擎服务
- `apps/api/src/services/socialInteraction.ts` - 社交互动服务

## 验收标准

### 功能验收
- [ ] 角色卡片正确展示所有必要信息
- [ ] 筛选功能精确有效，支持多条件组合
- [ ] 搜索功能响应迅速，结果相关性高
- [ ] 社交互动功能完整可用
- [ ] 推荐算法准确性达到70%以上

### 性能验收
- [ ] 瀑布流布局加载流畅，支持虚拟滚动
- [ ] 图片懒加载，首屏加载时间<3秒
- [ ] 筛选操作响应时间<500ms
- [ ] 大量数据时页面仍保持流畅

### 用户体验验收
- [ ] 界面美观现代，符合Instagram风格
- [ ] 交互流畅自然，学习成本低
- [ ] 移动端体验优秀
- [ ] 个性化推荐用户满意度>80%

## 技术细节

### 角色卡片数据结构
```typescript
interface CharacterCard {
  id: string;
  name: string;
  description: string;
  avatar: string;
  tags: string[];
  author: {
    id: string;
    name: string;
    avatar: string;
  };
  stats: {
    likes: number;
    downloads: number;
    rating: number;
    reviews: number;
  };
  createdAt: Date;
  price?: number;
}
```

### 筛选配置
```typescript
interface FilterConfig {
  categories: FilterOption[];
  tags: TagOption[];
  priceRange: [number, number];
  ratingRange: [number, number];
  sortBy: 'latest' | 'popular' | 'rating' | 'price';
  sortOrder: 'asc' | 'desc';
}
```

### 推荐算法参数
```typescript
interface RecommendationParams {
  userId: string;
  limit: number;
  algorithm: 'collaborative' | 'content-based' | 'hybrid';
  excludeOwned: boolean;
  diversity: number; // 0-1，多样性权重
}
```

## 测试计划

### 单元测试
- 角色卡片组件渲染测试
- 筛选逻辑正确性测试
- 推荐算法准确性测试

### 集成测试
- 完整浏览流程测试
- 筛选和搜索集成测试
- 社交互动功能测试

### 性能测试
- 大量数据加载性能测试
- 图片加载优化测试
- 移动端性能测试

### A/B测试
- 不同布局方案用户偏好测试
- 推荐算法效果对比测试
- 社交功能使用率测试

## 风险评估

### 技术风险
- **中风险**：推荐算法复杂度较高
- **低风险**：UI组件基于成熟框架
- **缓解措施**：分阶段实现，先基础功能后算法优化

### 业务风险
- **用户习惯**：界面变化可能影响用户习惯
- **性能影响**：复杂筛选可能影响查询性能
- **缓解措施**：提供新旧界面切换选项，优化数据库查询

## 数据库扩展

### 新增表结构
```sql
-- 用户行为表
CREATE TABLE user_behaviors (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  character_id UUID REFERENCES characters(id),
  action_type VARCHAR(50), -- 'view', 'like', 'favorite', 'download'
  created_at TIMESTAMP DEFAULT NOW()
);

-- 角色评分表
CREATE TABLE character_ratings (
  id UUID PRIMARY KEY,
  character_id UUID REFERENCES characters(id),
  user_id UUID REFERENCES users(id),
  rating INTEGER CHECK (rating >= 1 AND rating <= 5),
  review TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(character_id, user_id)
);

-- 用户关注表
CREATE TABLE user_follows (
  id UUID PRIMARY KEY,
  follower_id UUID REFERENCES users(id),
  following_id UUID REFERENCES users(id),
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(follower_id, following_id)
);
```

## 后续任务

- 与004任务（对话界面现代化）保持UI风格一致性
- 为006任务（移动端优化）提供移动友好的组件
- 支持007任务（AI能力增强）的智能推荐功能
- 与008任务（管理后台升级）的数据分析需求对接
