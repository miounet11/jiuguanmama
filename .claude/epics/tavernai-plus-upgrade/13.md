---
name: "èŠå¤©ç•Œé¢ç®€åŒ–"
status: pending
created: 2025-09-21T02:07:42Z
updated: 2025-09-21T02:36:29Z
github: https://github.com/miounet11/jiuguanbaba/issues/13
depends_on: []
parallel: true
conflicts_with: []
estimated_effort: M
estimated_hours: 32
epic: tavernai-plus-upgrade
tags: ["chat-interface", "minimal-design", "conversation-ui", "user-experience"]
---

# Task 003: èŠå¤©ç•Œé¢ç®€åŒ–

## æ¦‚è¿°

é‡æ„ChatSessionç»„ä»¶ï¼Œå®ç°æç®€å¯¹è¯ä½“éªŒã€‚é€šè¿‡ç®€åŒ–ç•Œé¢å…ƒç´ ã€ä¼˜åŒ–æ¶ˆæ¯æ˜¾ç¤ºã€å¢å¼ºäº¤äº’æµç•…æ€§ï¼Œå°†å¤æ‚çš„èŠå¤©ç•Œé¢è½¬æ¢ä¸ºä¸“æ³¨äºå¯¹è¯æœ¬èº«çš„æ²‰æµ¸å¼ä½“éªŒã€‚ä¿æŒåŠŸèƒ½å®Œæ•´æ€§çš„åŒæ—¶ï¼Œå¤§å¹…æå‡å¯¹è¯çš„ä¸“æ³¨åº¦å’Œæ„‰æ‚¦æ„Ÿã€‚

## ç›®æ ‡

- è®¾è®¡æç®€çš„å¯¹è¯ç•Œé¢ï¼Œçªå‡ºå¯¹è¯å†…å®¹
- ä¼˜åŒ–æ¶ˆæ¯æ°”æ³¡æ ·å¼å’Œæ’ç‰ˆï¼Œæå‡é˜…è¯»ä½“éªŒ
- ç®€åŒ–è¾“å…¥åŒºåŸŸï¼Œå‡å°‘å¹²æ‰°å…ƒç´ 
- å®ç°æµç•…çš„æ¶ˆæ¯åŠ¨ç”»å’Œäº¤äº’æ•ˆæœ
- ä¿ç•™é«˜çº§åŠŸèƒ½çš„å¿«æ·è®¿é—®æ–¹å¼

## æŠ€æœ¯è¦æ±‚

### æ ¸å¿ƒç»„ä»¶é‡æ„

#### 1. ChatInterfaceMinimal.vue - æç®€èŠå¤©ç•Œé¢
```vue
<template>
  <div class="chat-interface-minimal" :class="{ 'full-screen': isFullScreen }">
    <!-- é¡¶éƒ¨ä¿¡æ¯æ  - å¯éšè— -->
    <div class="chat-header" :class="{ 'hidden': headerHidden }">
      <div class="character-info">
        <img :src="character.avatar" :alt="character.name" class="character-avatar" />
        <div class="character-details">
          <h3>{{ character.name }}</h3>
          <span class="status-indicator" :class="aiStatus">{{ aiStatusText }}</span>
        </div>
      </div>

      <div class="chat-controls">
        <el-button text @click="toggleFullScreen">
          <FullScreen v-if="!isFullScreen" />
          <Aim v-else />
        </el-button>
        <el-button text @click="toggleSettings">
          <Setting />
        </el-button>
      </div>
    </div>

    <!-- æ¶ˆæ¯åŒºåŸŸ -->
    <div class="messages-container" ref="messagesContainer">
      <div class="messages-list" ref="messagesList">
        <!-- æ¬¢è¿æ¶ˆæ¯ -->
        <div v-if="messages.length === 0" class="welcome-message">
          <div class="character-greeting">
            <img :src="character.avatar" :alt="character.name" />
            <div class="greeting-text">
              <h4>Hi! I'm {{ character.name }}</h4>
              <p>{{ character.greeting || generateGreeting() }}</p>
            </div>
          </div>
        </div>

        <!-- æ¶ˆæ¯åˆ—è¡¨ -->
        <MessageBubble
          v-for="message in messages"
          :key="message.id"
          :message="message"
          :character="character"
          :show-avatar="shouldShowAvatar(message)"
          @message-action="handleMessageAction"
        />

        <!-- AIæ€è€ƒæŒ‡ç¤ºå™¨ -->
        <div v-if="isAiThinking" class="thinking-indicator">
          <div class="thinking-avatar">
            <img :src="character.avatar" :alt="character.name" />
            <div class="thinking-animation">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- è¾“å…¥åŒºåŸŸ -->
    <div class="input-area">
      <div class="input-container">
        <el-input
          v-model="currentMessage"
          :placeholder="inputPlaceholder"
          type="textarea"
          :autosize="{ minRows: 1, maxRows: 4 }"
          resize="none"
          @keydown="handleKeyDown"
          @focus="handleInputFocus"
          @blur="handleInputBlur"
          ref="messageInput"
        />

        <div class="input-actions">
          <el-button
            type="primary"
            :disabled="!canSendMessage"
            :loading="isSending"
            @click="sendMessage"
            circle
          >
            <Promotion />
          </el-button>
        </div>
      </div>

      <!-- å¿«æ·æ“ä½œæ  - ä»…åœ¨éœ€è¦æ—¶æ˜¾ç¤º -->
      <div class="quick-actions" v-if="showQuickActions">
        <el-button size="small" text @click="suggestResponse">
          ğŸ’¡ å»ºè®®å›å¤
        </el-button>
        <el-button size="small" text @click="changeStyle">
          ğŸ­ æ¢ä¸ªé£æ ¼
        </el-button>
        <el-button size="small" text @click="addWorldInfo">
          ğŸŒ æ·»åŠ èƒŒæ™¯
        </el-button>
      </div>
    </div>

    <!-- ä¾§è¾¹è®¾ç½®é¢æ¿ -->
    <ChatSettingsPanel
      v-model:visible="settingsVisible"
      :conversation="conversation"
      @settings-change="handleSettingsChange"
    />
  </div>
</template>
```

#### 2. MessageBubble.vue - ä¼˜åŒ–çš„æ¶ˆæ¯æ°”æ³¡
```vue
<template>
  <div
    class="message-bubble"
    :class="messageClasses"
    :data-message-id="message.id"
  >
    <!-- ç”¨æˆ·æ¶ˆæ¯ -->
    <div v-if="message.role === 'user'" class="user-message">
      <div class="message-content">
        <p>{{ message.content }}</p>
        <span class="message-time">{{ formatTime(message.timestamp) }}</span>
      </div>
    </div>

    <!-- AIæ¶ˆæ¯ -->
    <div v-else class="ai-message">
      <div class="message-header" v-if="showAvatar">
        <img :src="character.avatar" :alt="character.name" class="message-avatar" />
        <span class="character-name">{{ character.name }}</span>
      </div>

      <div class="message-content">
        <!-- æ”¯æŒæµå¼æ˜¾ç¤º -->
        <div class="message-text" v-if="!message.isStreaming">
          <MarkdownRenderer :content="message.content" />
        </div>
        <div class="message-text streaming" v-else>
          <StreamingText
            :content="message.content"
            :streaming="message.isStreaming"
            @stream-complete="handleStreamComplete"
          />
        </div>

        <!-- æ¶ˆæ¯æ“ä½œæŒ‰é’® -->
        <div class="message-actions" v-if="!message.isStreaming">
          <el-button size="small" text @click="regenerateMessage">
            <RefreshRight />
          </el-button>
          <el-button size="small" text @click="copyMessage">
            <CopyDocument />
          </el-button>
          <el-button size="small" text @click="editMessage">
            <Edit />
          </el-button>
        </div>

        <span class="message-time">{{ formatTime(message.timestamp) }}</span>
      </div>
    </div>
  </div>
</template>
```

#### 3. StreamingText.vue - æµå¼æ–‡æœ¬æ˜¾ç¤ºç»„ä»¶
```vue
<template>
  <div class="streaming-text">
    <span class="displayed-text">{{ displayedText }}</span>
    <span class="cursor" v-if="streaming">|</span>
  </div>
</template>

<script setup lang="ts">
interface Props {
  content: string
  streaming: boolean
  speed?: number
}

const props = withDefaults(defineProps<Props>(), {
  speed: 50 // æ¯ç§’å­—ç¬¦æ•°
})

const emit = defineEmits<{
  streamComplete: []
}>()

const displayedText = ref('')
const streamingTimer = ref<NodeJS.Timeout>()

watch(() => props.content, (newContent) => {
  if (props.streaming) {
    streamText(newContent)
  } else {
    displayedText.value = newContent
  }
})

const streamText = (targetText: string) => {
  let currentIndex = displayedText.value.length

  if (streamingTimer.value) {
    clearInterval(streamingTimer.value)
  }

  streamingTimer.value = setInterval(() => {
    if (currentIndex < targetText.length) {
      displayedText.value = targetText.substring(0, currentIndex + 1)
      currentIndex++
    } else {
      clearInterval(streamingTimer.value!)
      emit('streamComplete')
    }
  }, 1000 / props.speed)
}

onUnmounted(() => {
  if (streamingTimer.value) {
    clearInterval(streamingTimer.value)
  }
})
</script>
```

### æ ¸å¿ƒé€»è¾‘å®ç°

#### 1. useChatInterface.ts - èŠå¤©ç•Œé¢ç®¡ç†
```typescript
// composables/useChatInterface.ts
export function useChatInterface(conversationId: string) {
  const messages = ref<Message[]>([])
  const currentMessage = ref('')
  const isAiThinking = ref(false)
  const isSending = ref(false)
  const isFullScreen = ref(false)
  const headerHidden = ref(false)

  // æ¶ˆæ¯å‘é€é€»è¾‘
  const sendMessage = async () => {
    if (!canSendMessage.value) return

    try {
      isSending.value = true

      // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
      const userMessage = createUserMessage(currentMessage.value)
      messages.value.push(userMessage)

      // æ¸…ç©ºè¾“å…¥æ¡†å¹¶å¼€å§‹AIæ€è€ƒ
      const messageContent = currentMessage.value
      currentMessage.value = ''
      isAiThinking.value = true

      // æ»šåŠ¨åˆ°åº•éƒ¨
      await nextTick(() => scrollToBottom())

      // å‘é€åˆ°AIæœåŠ¡
      const aiResponse = await chatService.sendMessage({
        conversationId,
        message: messageContent,
        context: buildMessageContext()
      })

      // æ·»åŠ AIå“åº”
      isAiThinking.value = false
      const aiMessage = createAiMessage(aiResponse)
      messages.value.push(aiMessage)

      // å¦‚æœæ”¯æŒæµå¼å“åº”ï¼Œå¼€å§‹æµå¼æ˜¾ç¤º
      if (aiResponse.streaming) {
        await handleStreamingResponse(aiMessage, aiResponse.stream)
      }

    } catch (error) {
      console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error)
      handleSendError(error)
    } finally {
      isSending.value = false
      isAiThinking.value = false
    }
  }

  // å¤„ç†æµå¼å“åº”
  const handleStreamingResponse = async (
    message: Message,
    stream: ReadableStream
  ) => {
    message.isStreaming = true
    const reader = stream.getReader()

    try {
      while (true) {
        const { done, value } = await reader.read()
        if (done) break

        // æ›´æ–°æ¶ˆæ¯å†…å®¹
        message.content += value

        // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
        await nextTick(() => scrollToBottom())
      }
    } finally {
      message.isStreaming = false
      reader.releaseLock()
    }
  }

  // æ™ºèƒ½æ»šåŠ¨åˆ°åº•éƒ¨
  const scrollToBottom = (smooth = true) => {
    const container = messagesContainer.value
    if (!container) return

    const scrollOptions: ScrollToOptions = {
      top: container.scrollHeight,
      behavior: smooth ? 'smooth' : 'auto'
    }

    container.scrollTo(scrollOptions)
  }

  // è®¡ç®—æ˜¾ç¤ºçš„æ¶ˆæ¯
  const canSendMessage = computed(() => {
    return currentMessage.value.trim().length > 0 && !isSending.value
  })

  // ç”Ÿæˆè¾“å…¥æç¤º
  const inputPlaceholder = computed(() => {
    if (isAiThinking.value) return 'AIæ­£åœ¨æ€è€ƒ...'
    if (messages.value.length === 0) return `å’Œ${character.value.name}å¼€å§‹å¯¹è¯å§...`
    return 'è¾“å…¥æ¶ˆæ¯...'
  })

  return {
    messages,
    currentMessage,
    isAiThinking,
    isSending,
    isFullScreen,
    headerHidden,
    canSendMessage,
    inputPlaceholder,
    sendMessage,
    scrollToBottom
  }
}
```

#### 2. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
```typescript
// utils/chatOptimization.ts
export class ChatInterfaceOptimizer {
  private messageVirtualizer: VirtualScrollManager
  private animationFrameId: number | null = null

  constructor(private messagesContainer: HTMLElement) {
    this.messageVirtualizer = new VirtualScrollManager(messagesContainer)
  }

  // è™šæ‹Ÿæ»šåŠ¨ç®¡ç† - å¤„ç†å¤§é‡æ¶ˆæ¯
  enableVirtualScrolling(messages: Message[]) {
    if (messages.length > 100) { // è¶…è¿‡100æ¡æ¶ˆæ¯å¯ç”¨è™šæ‹Ÿæ»šåŠ¨
      this.messageVirtualizer.enable()
      return this.messageVirtualizer.getVisibleMessages(messages)
    }
    return messages
  }

  // æ™ºèƒ½åŠ¨ç”»ç®¡ç†
  scheduleAnimation(callback: () => void) {
    if (this.animationFrameId) {
      cancelAnimationFrame(this.animationFrameId)
    }

    this.animationFrameId = requestAnimationFrame(() => {
      callback()
      this.animationFrameId = null
    })
  }

  // æ¶ˆæ¯é¢„åŠ è½½
  preloadMessageAssets(messages: Message[]) {
    const imageUrls = messages
      .filter(msg => msg.attachments?.some(att => att.type === 'image'))
      .flatMap(msg => msg.attachments?.map(att => att.url) || [])

    imageUrls.forEach(url => {
      const img = new Image()
      img.src = url
    })
  }

  // å†…å­˜æ¸…ç†
  cleanup() {
    if (this.animationFrameId) {
      cancelAnimationFrame(this.animationFrameId)
    }
    this.messageVirtualizer.cleanup()
  }
}
```

### æ ·å¼ç³»ç»Ÿ

#### 1. æç®€èŠå¤©ç•Œé¢æ ·å¼
```scss
// styles/components/chat-interface-minimal.scss
.chat-interface-minimal {
  display: flex;
  flex-direction: column;
  height: 100vh;
  background: var(--el-bg-color-page);
  position: relative;

  &.full-screen {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 9999;
    background: var(--el-bg-color);
  }

  .chat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    border-bottom: 1px solid var(--el-border-color-light);
    background: var(--el-bg-color);
    transition: transform 0.3s ease;

    &.hidden {
      transform: translateY(-100%);
    }

    .character-info {
      display: flex;
      align-items: center;
      gap: 12px;

      .character-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
      }

      .character-details {
        h3 {
          margin: 0;
          font-size: 16px;
          font-weight: 600;
          color: var(--el-text-color-primary);
        }

        .status-indicator {
          font-size: 12px;
          color: var(--el-text-color-secondary);

          &.online { color: var(--el-color-success); }
          &.thinking { color: var(--el-color-warning); }
          &.offline { color: var(--el-text-color-disabled); }
        }
      }
    }

    .chat-controls {
      display: flex;
      gap: 8px;
    }
  }

  .messages-container {
    flex: 1;
    overflow-y: auto;
    padding: 0 20px;
    scroll-behavior: smooth;

    &::-webkit-scrollbar {
      width: 6px;
    }

    &::-webkit-scrollbar-track {
      background: transparent;
    }

    &::-webkit-scrollbar-thumb {
      background: var(--el-border-color);
      border-radius: 3px;

      &:hover {
        background: var(--el-border-color-dark);
      }
    }
  }

  .messages-list {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px 0;
  }

  .welcome-message {
    text-align: center;
    padding: 40px 20px;

    .character-greeting {
      display: inline-flex;
      align-items: center;
      gap: 16px;
      padding: 20px;
      background: var(--el-bg-color);
      border-radius: 16px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);

      img {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        object-fit: cover;
      }

      .greeting-text {
        text-align: left;

        h4 {
          margin: 0 0 8px 0;
          color: var(--el-text-color-primary);
        }

        p {
          margin: 0;
          color: var(--el-text-color-regular);
          font-style: italic;
        }
      }
    }
  }

  .thinking-indicator {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px 0;
    animation: fadeIn 0.3s ease;

    .thinking-avatar {
      position: relative;

      img {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        object-fit: cover;
      }

      .thinking-animation {
        position: absolute;
        bottom: -4px;
        right: -4px;
        display: flex;
        gap: 2px;

        span {
          width: 4px;
          height: 4px;
          background: var(--el-color-primary);
          border-radius: 50%;
          animation: thinking 1.5s infinite;

          &:nth-child(2) { animation-delay: 0.2s; }
          &:nth-child(3) { animation-delay: 0.4s; }
        }
      }
    }
  }

  .input-area {
    padding: 16px 20px;
    background: var(--el-bg-color);
    border-top: 1px solid var(--el-border-color-light);

    .input-container {
      max-width: 800px;
      margin: 0 auto;
      display: flex;
      align-items: flex-end;
      gap: 12px;

      .el-textarea {
        flex: 1;

        :deep(.el-textarea__inner) {
          border-radius: 20px;
          padding: 12px 16px;
          border: 1px solid var(--el-border-color);
          background: var(--el-fill-color-blank);
          resize: none;
          line-height: 1.4;

          &:focus {
            border-color: var(--el-color-primary);
            box-shadow: 0 0 0 2px var(--el-color-primary-light-8);
          }
        }
      }

      .input-actions {
        .el-button {
          width: 44px;
          height: 44px;
        }
      }
    }

    .quick-actions {
      max-width: 800px;
      margin: 12px auto 0;
      display: flex;
      gap: 8px;
      justify-content: center;
    }
  }
}
```

#### 2. æ¶ˆæ¯æ°”æ³¡æ ·å¼
```scss
// styles/components/message-bubble.scss
.message-bubble {
  margin-bottom: 16px;
  animation: messageSlideIn 0.3s ease;

  &.user-message-bubble {
    display: flex;
    justify-content: flex-end;

    .user-message {
      max-width: 70%;
      background: var(--el-color-primary);
      color: white;
      padding: 12px 16px;
      border-radius: 18px 18px 4px 18px;
      position: relative;

      .message-content {
        p {
          margin: 0 0 4px 0;
          line-height: 1.4;
        }

        .message-time {
          font-size: 11px;
          opacity: 0.8;
          float: right;
        }
      }
    }
  }

  &.ai-message-bubble {
    .ai-message {
      max-width: 80%;

      .message-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;

        .message-avatar {
          width: 28px;
          height: 28px;
          border-radius: 50%;
          object-fit: cover;
        }

        .character-name {
          font-size: 14px;
          font-weight: 500;
          color: var(--el-text-color-primary);
        }
      }

      .message-content {
        background: var(--el-bg-color);
        padding: 12px 16px;
        border-radius: 4px 18px 18px 18px;
        border: 1px solid var(--el-border-color-lighter);
        position: relative;

        .message-text {
          margin-bottom: 8px;
          line-height: 1.6;
          color: var(--el-text-color-primary);

          &.streaming {
            .cursor {
              animation: blink 1s infinite;
            }
          }
        }

        .message-actions {
          display: flex;
          gap: 4px;
          opacity: 0;
          transition: opacity 0.2s ease;
        }

        &:hover .message-actions {
          opacity: 1;
        }

        .message-time {
          font-size: 11px;
          color: var(--el-text-color-secondary);
          float: right;
        }
      }
    }
  }
}

@keyframes messageSlideIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes thinking {
  0%, 60%, 100% {
    transform: scale(1);
    opacity: 0.7;
  }
  30% {
    transform: scale(1.4);
    opacity: 1;
  }
}

@keyframes blink {
  0%, 50% { opacity: 1; }
  51%, 100% { opacity: 0; }
}
```

## éªŒæ”¶æ ‡å‡†

### ç”¨æˆ·ä½“éªŒéªŒæ”¶æ ‡å‡†
- [ ] **ç•Œé¢æç®€æ¸…çˆ½**ï¼šæ¶ˆæ¯åŒºåŸŸå å±å¹•80%ä»¥ä¸Šï¼Œæ— å¹²æ‰°å…ƒç´ 
- [ ] **æ¶ˆæ¯é˜…è¯»èˆ’é€‚**ï¼šæ¶ˆæ¯æ°”æ³¡è®¾è®¡ç¾è§‚ï¼Œæ–‡å­—æ˜“è¯»ï¼Œå±‚æ¬¡æ¸…æ™°
- [ ] **è¾“å…¥ä½“éªŒæµç•…**ï¼šè¾“å…¥æ¡†è‡ªé€‚åº”é«˜åº¦ï¼Œæ”¯æŒå¤šè¡Œï¼Œå¿«æ·é”®æ“ä½œ
- [ ] **åŠ¨ç”»æ•ˆæœè‡ªç„¶**ï¼šæ¶ˆæ¯å‡ºç°ã€AIæ€è€ƒã€æ»šåŠ¨ç­‰åŠ¨ç”»æµç•…ä¸çªå…€
- [ ] **å“åº”å¼é€‚é…å®Œç¾**ï¼šåœ¨æ‰‹æœºã€å¹³æ¿ã€æ¡Œé¢ç«¯éƒ½æœ‰æœ€ä½³æ˜¾ç¤ºæ•ˆæœ

### åŠŸèƒ½éªŒæ”¶æ ‡å‡†
- [ ] **æ¶ˆæ¯å‘é€æ­£å¸¸**ï¼šæ–‡æœ¬æ¶ˆæ¯ã€è¡¨æƒ…ã€å¿«æ·æ“ä½œéƒ½èƒ½æ­£å¸¸å‘é€
- [ ] **AIå“åº”å®Œæ•´**ï¼šæ”¯æŒæ™®é€šå›å¤å’Œæµå¼å›å¤ï¼Œæ˜¾ç¤ºæ•ˆæœè‰¯å¥½
- [ ] **æ¶ˆæ¯æ“ä½œé½å…¨**ï¼šé‡æ–°ç”Ÿæˆã€å¤åˆ¶ã€ç¼–è¾‘ç­‰æ“ä½œåŠŸèƒ½æ­£å¸¸
- [ ] **è®¾ç½®é¢æ¿å¯ç”¨**ï¼šä¾§è¾¹è®¾ç½®é¢æ¿èƒ½æ­£ç¡®æ˜¾ç¤ºå’Œä¿®æ”¹å¯¹è¯é…ç½®
- [ ] **å…¨å±æ¨¡å¼æ­£å¸¸**ï¼šå…¨å±å¯¹è¯æ¨¡å¼åˆ‡æ¢æ­£å¸¸ï¼Œæ²‰æµ¸ä½“éªŒè‰¯å¥½

### æ€§èƒ½éªŒæ”¶æ ‡å‡†
- [ ] **æ¶ˆæ¯åŠ è½½å¿«é€Ÿ**ï¼šå†å²æ¶ˆæ¯åŠ è½½æ—¶é—´<2ç§’ï¼Œæ–°æ¶ˆæ¯å“åº”<100ms
- [ ] **æ»šåŠ¨æ€§èƒ½è‰¯å¥½**ï¼šé•¿å¯¹è¯ï¼ˆ>100æ¡æ¶ˆæ¯ï¼‰æ»šåŠ¨æµç•…ï¼Œæ— å¡é¡¿
- [ ] **å†…å­˜ä½¿ç”¨åˆç†**ï¼šé•¿æ—¶é—´å¯¹è¯åå†…å­˜å ç”¨ç¨³å®šï¼Œæ— æ˜æ˜¾æ³„æ¼
- [ ] **åŠ¨ç”»æ€§èƒ½ç¨³å®š**ï¼š60fpsæµç•…åŠ¨ç”»ï¼ŒCPUå ç”¨åˆç†
- [ ] **è™šæ‹Ÿæ»šåŠ¨ç”Ÿæ•ˆ**ï¼šè¶…é•¿æ¶ˆæ¯åˆ—è¡¨è‡ªåŠ¨å¯ç”¨è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–

## å®æ–½ç»†èŠ‚

### æ–‡ä»¶ç»“æ„
```
apps/web/src/
â”œâ”€â”€ components/chat/
â”‚   â”œâ”€â”€ ChatInterfaceMinimal.vue        # æç®€èŠå¤©ä¸»ç•Œé¢
â”‚   â”œâ”€â”€ MessageBubble.vue               # ä¼˜åŒ–çš„æ¶ˆæ¯æ°”æ³¡
â”‚   â”œâ”€â”€ StreamingText.vue               # æµå¼æ–‡æœ¬æ˜¾ç¤º
â”‚   â”œâ”€â”€ ChatSettingsPanel.vue          # èŠå¤©è®¾ç½®é¢æ¿
â”‚   â””â”€â”€ ThinkingIndicator.vue           # AIæ€è€ƒæŒ‡ç¤ºå™¨
â”œâ”€â”€ composables/
â”‚   â”œâ”€â”€ useChatInterface.ts             # èŠå¤©ç•Œé¢ç®¡ç†
â”‚   â”œâ”€â”€ useMessageStream.ts             # æµå¼æ¶ˆæ¯å¤„ç†
â”‚   â””â”€â”€ useChatOptimization.ts          # æ€§èƒ½ä¼˜åŒ–
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ chatOptimization.ts             # èŠå¤©æ€§èƒ½ä¼˜åŒ–å·¥å…·
â”‚   â”œâ”€â”€ messageFormatting.ts            # æ¶ˆæ¯æ ¼å¼åŒ–
â”‚   â””â”€â”€ virtualScrolling.ts             # è™šæ‹Ÿæ»šåŠ¨å®ç°
â””â”€â”€ styles/components/
    â”œâ”€â”€ chat-interface-minimal.scss     # èŠå¤©ç•Œé¢æ ·å¼
    â”œâ”€â”€ message-bubble.scss             # æ¶ˆæ¯æ°”æ³¡æ ·å¼
    â””â”€â”€ chat-animations.scss            # èŠå¤©åŠ¨ç”»æ ·å¼
```

### çŠ¶æ€ç®¡ç†é›†æˆ
```typescript
// stores/chatInterface.ts
export const useChatInterfaceStore = defineStore('chatInterface', () => {
  const currentConversation = ref<Conversation | null>(null)
  const interfaceSettings = ref({
    fullScreen: false,
    headerHidden: false,
    compactMode: false,
    animationsEnabled: true
  })

  // æ¶ˆæ¯æ˜¾ç¤ºé…ç½®
  const messageDisplayConfig = computed(() => ({
    showAvatars: !interfaceSettings.value.compactMode,
    showTimestamps: true,
    groupSimilarMessages: true,
    enableMarkdown: true,
    maxMessageLength: 2000
  }))

  // æŒä¹…åŒ–ç•Œé¢è®¾ç½®
  const saveInterfaceSettings = () => {
    localStorage.setItem('chatInterfaceSettings', JSON.stringify(interfaceSettings.value))
  }

  // åŠ è½½ç•Œé¢è®¾ç½®
  const loadInterfaceSettings = () => {
    const saved = localStorage.getItem('chatInterfaceSettings')
    if (saved) {
      interfaceSettings.value = { ...interfaceSettings.value, ...JSON.parse(saved) }
    }
  }

  return {
    currentConversation,
    interfaceSettings,
    messageDisplayConfig,
    saveInterfaceSettings,
    loadInterfaceSettings
  }
})
```

## Definition of Done

### è§†è§‰è®¾è®¡æ£€æŸ¥æ¸…å•
- [ ] **è®¾è®¡ä¸€è‡´æ€§**ï¼šä¸æ•´ä½“è®¾è®¡ç³»ç»Ÿä¿æŒä¸€è‡´ï¼Œç¬¦åˆå“ç‰Œè§†è§‰è§„èŒƒ
- [ ] **è‰²å½©æ­é…åˆç†**ï¼šæ”¯æŒäº®è‰²/æš—è‰²ä¸»é¢˜ï¼Œè‰²å½©å¯¹æ¯”åº¦ç¬¦åˆWCAGæ ‡å‡†
- [ ] **å­—ä½“æ’ç‰ˆä¼˜ç¾**ï¼šæ¶ˆæ¯æ–‡å­—æ˜“è¯»ï¼Œå­—å·ã€è¡Œè·ã€é—´è·è®¾è®¡åˆç†
- [ ] **åŠ¨ç”»æ•ˆæœæ°å½“**ï¼šåŠ¨ç”»æ—¶é•¿ã€ç¼“åŠ¨å‡½æ•°ã€è§¦å‘æ—¶æœºéƒ½ç»è¿‡ç²¾å¿ƒè®¾è®¡
- [ ] **ç§»åŠ¨ç«¯é€‚é…å®Œç¾**ï¼šåœ¨å°å±å¹•è®¾å¤‡ä¸Šäº¤äº’åŒºåŸŸå¤§å°åˆé€‚ï¼Œæ“ä½œä¾¿æ·

### æŠ€æœ¯å®ç°æ£€æŸ¥æ¸…å•
- [ ] **ç»„ä»¶æ¶æ„æ¸…æ™°**ï¼šç»„ä»¶èŒè´£å•ä¸€ï¼Œå¯å¤ç”¨æ€§å¼ºï¼Œä»£ç ç»“æ„æ¸…æ™°
- [ ] **æ€§èƒ½ä¼˜åŒ–åˆ°ä½**ï¼šè™šæ‹Ÿæ»šåŠ¨ã€æ‡’åŠ è½½ã€é˜²æŠ–ç­‰ä¼˜åŒ–æªæ–½æ­£ç¡®å®æ–½
- [ ] **é”™è¯¯å¤„ç†å®Œå–„**ï¼šç½‘ç»œé”™è¯¯ã€AIæœåŠ¡å¼‚å¸¸ç­‰æƒ…å†µéƒ½æœ‰é€‚å½“å¤„ç†
- [ ] **çŠ¶æ€ç®¡ç†æ­£ç¡®**ï¼šèŠå¤©çŠ¶æ€ã€ç•Œé¢çŠ¶æ€ç®¡ç†é€»è¾‘æ­£ç¡®ï¼Œæ— çŠ¶æ€æ³„æ¼
- [ ] **ç±»å‹å®‰å…¨ä¿è¯**ï¼šTypeScriptç±»å‹å®šä¹‰å®Œæ•´ï¼Œæ— ç±»å‹é”™è¯¯

### é›†æˆæµ‹è¯•æ£€æŸ¥æ¸…å•
- [ ] **ä¸ç°æœ‰ç³»ç»Ÿå…¼å®¹**ï¼šä¸ç°æœ‰çš„èŠå¤©æœåŠ¡ã€WebSocketæœåŠ¡æ­£ç¡®é›†æˆ
- [ ] **è·¯ç”±è·³è½¬æ­£å¸¸**ï¼šä»å…¶ä»–é¡µé¢è¿›å…¥èŠå¤©ç•Œé¢ï¼Œå‚æ•°ä¼ é€’æ­£ç¡®
- [ ] **æ•°æ®æŒä¹…åŒ–æ­£å¸¸**ï¼šç•Œé¢è®¾ç½®ã€æ¶ˆæ¯å†å²ç­‰æ•°æ®æ­£ç¡®ä¿å­˜å’ŒåŠ è½½
- [ ] **å®æ—¶åŠŸèƒ½æ­£å¸¸**ï¼šWebSocketè¿æ¥ã€å®æ—¶æ¶ˆæ¯æ¨é€åŠŸèƒ½æ­£å¸¸
- [ ] **APIé›†æˆå®Œæ•´**ï¼šæ‰€æœ‰èŠå¤©ç›¸å…³APIè°ƒç”¨æ­£ç¡®ï¼Œé”™è¯¯å¤„ç†å®Œå–„

---

*æœ¬ä»»åŠ¡å°†åˆ›å»ºä¸€ä¸ªä¸“æ³¨äºå¯¹è¯æœ¬èº«çš„æ²‰æµ¸å¼èŠå¤©ä½“éªŒï¼Œé€šè¿‡æç®€è®¾è®¡å’Œæµç•…äº¤äº’ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿæ›´ä¸“æ³¨äºä¸AIè§’è‰²çš„å¯¹è¯å†…å®¹ï¼Œæå‡æ•´ä½“çš„å¯¹è¯è´¨é‡å’Œç”¨æˆ·æ»¡æ„åº¦ã€‚*