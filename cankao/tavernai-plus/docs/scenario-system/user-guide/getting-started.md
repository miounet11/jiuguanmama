# 情景剧本系统 - 快速开始指南

## 概述

情景剧本与世界信息系统是 TavernAI Plus 的核心功能，允许您为 AI 角色对话创建丰富的背景世界。通过关键词触发机制，系统会在对话中自动注入相关的世界信息，大幅提升角色扮演的沉浸感和一致性。

## 核心概念

### 🎭 剧本 (Scenario)
剧本是一个完整的世界设定容器，包含：
- **基础信息**：名称、描述、标签
- **世界信息条目**：具体的背景知识
- **访问控制**：公开或私有设置

### 📚 世界信息条目 (World Info Entry)
每个条目包含：
- **标题**：条目的简短名称
- **内容**：详细的背景描述
- **关键词**：触发条目的关键词列表
- **优先级**：注入时的优先顺序（1-100）
- **匹配类型**：精确匹配、正则表达式等

### 🔍 关键词匹配
系统支持多种匹配模式：
- **精确匹配**：完全匹配关键词
- **模糊匹配**：支持变形和相似词
- **正则表达式**：高级模式匹配
- **语义匹配**：基于含义的智能匹配

## 5分钟快速上手

### 步骤1：创建剧本

1. 进入「创作工坊」→「剧本管理」
2. 点击「创建新剧本」
3. 填写基础信息：
   ```
   名称: 魔法学院
   描述: 一个充满魔法与奇迹的学院世界
   标签: 魔法, 奇幻, 学院
   ```

### 步骤2：添加世界信息

点击「添加世界信息」，创建第一个条目：

```
标题: 霍格沃兹魔法学院
内容: 这是一所古老的魔法学院，位于苏格兰高地。学院分为四个学院：格兰芬多、拉文克劳、赫奇帕奇和斯莱特林。每个学院都有自己的传统和特色。
关键词: 霍格沃兹, 魔法学院, 学院, 格兰芬多, 拉文克劳
优先级: 90
```

### 步骤3：测试触发效果

1. 前往「对话」页面
2. 选择或创建一个角色
3. 在剧本设置中选择「魔法学院」
4. 发送包含关键词的消息：「告诉我关于魔法学院的事情」

系统会自动检测到「魔法学院」关键词，并将相关世界信息注入到 AI 的上下文中，让回复更加丰富和准确。

## 高级功能

### 🎯 优先级管理

优先级决定了多个条目同时触发时的注入顺序：

- **90-100**：核心世界设定（主要位置、关键角色）
- **70-89**：重要背景信息（历史、文化、规则）
- **50-69**：一般信息（日常物品、普通角色）
- **30-49**：次要细节（装饰性描述）
- **1-29**：补充信息（可选内容）

### 🔧 高级匹配设置

```
匹配类型: 正则表达式
关键词: 魔法学院|魔法.*学校|.*magic.*academy
大小写敏感: 否
递归扫描: 是
递归深度: 2
概率触发: 100%
```

### 📊 Token 预算管理

系统会智能管理 token 使用：

- **自动优化**：根据模型限制调整注入内容
- **优先级排序**：优先注入高优先级条目
- **长度控制**：确保不超出模型上下文限制
- **性能监控**：实时显示 token 使用情况

## 最佳实践

### ✅ 推荐做法

1. **结构化组织**
   ```
   核心设定 (优先级 90+)
   ├── 主要位置
   ├── 关键角色
   └── 基础规则

   背景信息 (优先级 70-89)
   ├── 历史背景
   ├── 文化习俗
   └── 社会结构

   详细描述 (优先级 50-69)
   ├── 日常物品
   ├── 次要角色
   └── 环境细节
   ```

2. **关键词策略**
   - 使用多个相关词语：`魔法学院, 学院, 霍格沃兹`
   - 包含变体形式：`魔法, 法术, 咒语`
   - 考虑用户可能的表达方式

3. **内容编写**
   - 保持简洁明了，避免冗长描述
   - 使用第三人称视角
   - 重点突出可操作的信息

### ❌ 避免的问题

1. **过度重叠**：避免多个条目使用相同关键词
2. **优先级混乱**：保持逻辑清晰的优先级分配
3. **内容过长**：单个条目建议控制在200字以内
4. **关键词过少**：每个条目至少包含3-5个关键词

## 性能优化

### 🚀 响应速度优化

- **关键词匹配** < 100ms (95th percentile)
- **世界信息注入** < 200ms (95th percentile)
- **大型剧本加载** < 1s (1000+ 条目)

### 💾 缓存策略

系统会智能缓存匹配结果：
- **短期缓存**：5分钟内的相同查询
- **LRU 策略**：自动清理最少使用的缓存
- **手动刷新**：修改剧本后自动清除缓存

### 📱 移动端优化

- **简化界面**：针对触摸操作优化
- **快捷操作**：长按显示上下文菜单
- **离线编辑**：支持离线创建和编辑

## 兼容性说明

### SillyTavern 格式支持

系统完全兼容 SillyTavern 的 World Info 格式：

```json
{
  "entries": {
    "0": {
      "uid": 1,
      "key": ["魔法学院"],
      "content": "学院描述内容",
      "order": 100,
      "position": 0,
      "disable": false
    }
  }
}
```

### 增强功能

TavernAI Plus 在兼容的基础上提供增强功能：

- **递归匹配**：支持条目间的相互触发
- **概率控制**：条目触发的概率设置
- **正则表达式**：高级模式匹配
- **语义搜索**：基于 AI 的智能匹配
- **性能监控**：详细的使用统计

## 故障排除

### 常见问题

**Q: 为什么我的世界信息没有被触发？**

A: 检查以下几点：
1. 关键词是否包含在对话中
2. 条目是否处于激活状态
3. 优先级设置是否合理
4. Token 预算是否充足

**Q: 如何提高匹配准确率？**

A: 建议：
1. 增加更多相关关键词
2. 使用模糊匹配模式
3. 调整关键词的变体形式
4. 检查大小写设置

**Q: 系统响应变慢怎么办？**

A: 优化措施：
1. 减少不必要的条目数量
2. 优化关键词设置
3. 清理缓存数据
4. 检查网络连接

### 技术支持

如果遇到问题，可以：

1. **查看日志**：在设置中启用调试模式
2. **性能监控**：查看系统性能指标
3. **社区求助**：访问 GitHub Issues
4. **反馈建议**：通过应用内反馈功能

## 下一步

- 📖 阅读 [剧本创建详细教程](./scenario-creation.md)
- ⚙️ 学习 [世界信息配置指南](./worldinfo-configuration.md)
- 📥 了解 [导入导出功能](./import-export.md)
- 🔧 查看 [问题排查指南](./troubleshooting.md)

---

*最后更新：2025年9月23日*