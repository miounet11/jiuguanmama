<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TavernAI Plus - 智能工作流平台</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.6/vis-network.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/workflow-editor.css">
    <link rel="stylesheet" href="css/components.css">
</head>
<body>
    <div id="app">
        <!-- 顶部导航栏 -->
        <nav class="navbar">
            <div class="navbar-brand">
                <h1><i class="fas fa-magic"></i> TavernAI Plus</h1>
                <span class="version">v2.2</span>
            </div>
            <div class="navbar-nav">
                <a href="#dashboard" class="nav-link active"><i class="fas fa-home"></i> 工作台</a>
                <a href="#workflows" class="nav-link"><i class="fas fa-project-diagram"></i> 工作流</a>
                <a href="#characters" class="nav-link"><i class="fas fa-user-friends"></i> 角色</a>
                <a href="#templates" class="nav-link"><i class="fas fa-layer-group"></i> 模板</a>
                <a href="#analytics" class="nav-link"><i class="fas fa-chart-line"></i> 分析</a>
            </div>
            <div class="navbar-actions">
                <button class="btn btn-primary" id="createWorkflowBtn">
                    <i class="fas fa-plus"></i> 新建工作流
                </button>
                <div class="user-menu">
                    <img src="https://via.placeholder.com/32" alt="用户头像" class="user-avatar">
                    <span class="username" id="username">游客</span>
                </div>
            </div>
        </nav>

        <!-- 侧边栏 -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <h3><i class="fas fa-tachometer-alt"></i> 快速操作</h3>
                <ul class="sidebar-menu">
                    <li><a href="#" id="quickCreateBtn"><i class="fas fa-bolt"></i> 快速创建</a></li>
                    <li><a href="#" id="aiAssistantBtn"><i class="fas fa-robot"></i> AI助手</a></li>
                    <li><a href="#" id="templatesBtn"><i class="fas fa-file-alt"></i> 工作流模板</a></li>
                </ul>
            </div>
            <div class="sidebar-section">
                <h3><i class="fas fa-history"></i> 最近工作流</h3>
                <ul class="recent-workflows" id="recentWorkflows">
                    <!-- 动态生成 -->
                </ul>
            </div>
            <div class="sidebar-section">
                <h3><i class="fas fa-star"></i> 收藏</h3>
                <ul class="favorites" id="favorites">
                    <!-- 动态生成 -->
                </ul>
            </div>
        </aside>

        <!-- 主内容区域 -->
        <main class="main-content">
            <!-- 工作台页面 -->
            <div id="dashboardPage" class="page active">
                <div class="page-header">
                    <h2><i class="fas fa-home"></i> 工作台</h2>
                    <p>欢迎使用TavernAI Plus智能工作流平台</p>
                </div>

                <!-- 统计卡片 -->
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-project-diagram"></i></div>
                        <div class="stat-content">
                            <h3 id="totalWorkflows">0</h3>
                            <p>工作流总数</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-play"></i></div>
                        <div class="stat-content">
                            <h3 id="runningWorkflows">0</h3>
                            <p>运行中</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                        <div class="stat-content">
                            <h3 id="completedWorkflows">0</h3>
                            <p>已完成</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-user-friends"></i></div>
                        <div class="stat-content">
                            <h3 id="totalCharacters">0</h3>
                            <p>召唤角色</p>
                        </div>
                    </div>
                </div>

                <!-- 快速开始 -->
                <div class="quick-start">
                    <h3><i class="fas fa-rocket"></i> 快速开始</h3>
                    <div class="quick-actions">
                        <button class="action-card" data-action="create-ai-workflow">
                            <i class="fas fa-brain"></i>
                            <h4>AI智能工作流</h4>
                            <p>使用AI助手快速生成工作流</p>
                        </button>
                        <button class="action-card" data-action="create-character-workflow">
                            <i class="fas fa-user-plus"></i>
                            <h4>角色召唤工作流</h4>
                            <p>创建智能角色召唤自动化流程</p>
                        </button>
                        <button class="action-card" data-action="create-data-workflow">
                            <i class="fas fa-database"></i>
                            <h4>数据处理工作流</h4>
                            <p>构建数据分析和处理管道</p>
                        </button>
                        <button class="action-card" data-action="import-template">
                            <i class="fas fa-download"></i>
                            <h4>导入模板</h4>
                            <p>从模板库选择预制工作流</p>
                        </button>
                    </div>
                </div>
            </div>

            <!-- 工作流页面 -->
            <div id="workflowsPage" class="page">
                <div class="page-header">
                    <h2><i class="fas fa-project-diagram"></i> 工作流管理</h2>
                    <div class="page-actions">
                        <button class="btn btn-secondary" id="importWorkflowBtn">
                            <i class="fas fa-upload"></i> 导入
                        </button>
                        <button class="btn btn-primary" id="newWorkflowBtn">
                            <i class="fas fa-plus"></i> 新建工作流
                        </button>
                    </div>
                </div>

                <!-- 工作流筛选器 -->
                <div class="filters">
                    <div class="filter-group">
                        <label>状态:</label>
                        <select id="statusFilter">
                            <option value="">全部</option>
                            <option value="active">活跃</option>
                            <option value="paused">暂停</option>
                            <option value="completed">完成</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>类型:</label>
                        <select id="typeFilter">
                            <option value="">全部类型</option>
                            <option value="ai">AI工作流</option>
                            <option value="character">角色工作流</option>
                            <option value="data">数据工作流</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>搜索:</label>
                        <input type="text" id="searchInput" placeholder="搜索工作流...">
                    </div>
                </div>

                <!-- 工作流列表 -->
                <div class="workflows-grid" id="workflowsGrid">
                    <!-- 动态生成工作流卡片 -->
                </div>
            </div>

            <!-- 工作流编辑器页面 -->
            <div id="workflowEditorPage" class="page">
                <div class="editor-header">
                    <div class="editor-title">
                        <input type="text" id="workflowTitle" placeholder="工作流名称" value="未命名工作流">
                        <span class="editor-status" id="editorStatus">未保存</span>
                    </div>
                    <div class="editor-actions">
                        <button class="btn btn-secondary" id="saveWorkflowBtn">
                            <i class="fas fa-save"></i> 保存
                        </button>
                        <button class="btn btn-success" id="runWorkflowBtn">
                            <i class="fas fa-play"></i> 运行
                        </button>
                        <button class="btn btn-secondary" id="closeEditorBtn">
                            <i class="fas fa-times"></i> 关闭
                        </button>
                    </div>
                </div>

                <div class="editor-content">
                    <!-- 节点面板 -->
                    <div class="node-panel">
                        <h3><i class="fas fa-puzzle-piece"></i> 节点库</h3>
                        <div class="node-categories">
                            <div class="node-category active" data-category="basic">
                                <h4><i class="fas fa-play-circle"></i> 基础节点</h4>
                                <div class="nodes">
                                    <div class="node-item" data-type="start">
                                        <i class="fas fa-play"></i>
                                        <span>开始</span>
                                    </div>
                                    <div class="node-item" data-type="end">
                                        <i class="fas fa-stop"></i>
                                        <span>结束</span>
                                    </div>
                                    <div class="node-item" data-type="condition">
                                        <i class="fas fa-question-circle"></i>
                                        <span>条件判断</span>
                                    </div>
                                    <div class="node-item" data-type="variable">
                                        <i class="fas fa-code"></i>
                                        <span>变量设置</span>
                                    </div>
                                    <div class="node-item" data-type="delay">
                                        <i class="fas fa-clock"></i>
                                        <span>延迟</span>
                                    </div>
                                </div>
                            </div>
                            <div class="node-category" data-category="ai">
                                <h4><i class="fas fa-brain"></i> AI节点</h4>
                                <div class="nodes">
                                    <div class="node-item" data-type="ai_chat">
                                        <i class="fas fa-robot"></i>
                                        <span>AI对话</span>
                                    </div>
                                    <div class="node-item" data-type="character_summon">
                                        <i class="fas fa-user-plus"></i>
                                        <span>角色召唤</span>
                                    </div>
                                    <div class="node-item" data-type="vector_search">
                                        <i class="fas fa-search"></i>
                                        <span>向量搜索</span>
                                    </div>
                                </div>
                            </div>
                            <div class="node-category" data-category="action">
                                <h4><i class="fas fa-cogs"></i> 动作节点</h4>
                                <div class="nodes">
                                    <div class="node-item" data-type="http_request">
                                        <i class="fas fa-globe"></i>
                                        <span>HTTP请求</span>
                                    </div>
                                    <div class="node-item" data-type="email">
                                        <i class="fas fa-envelope"></i>
                                        <span>发送邮件</span>
                                    </div>
                                    <div class="node-item" data-type="notification">
                                        <i class="fas fa-bell"></i>
                                        <span>通知</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 工作流画布 -->
                    <div class="workflow-canvas">
                        <div class="canvas-toolbar">
                            <button class="btn btn-sm" id="zoomInBtn"><i class="fas fa-plus"></i></button>
                            <button class="btn btn-sm" id="zoomOutBtn"><i class="fas fa-minus"></i></button>
                            <button class="btn btn-sm" id="fitToScreenBtn"><i class="fas fa-expand-arrows-alt"></i></button>
                            <button class="btn btn-sm" id="clearCanvasBtn"><i class="fas fa-trash"></i></button>
                        </div>
                        <div id="workflowCanvas"></div>
                    </div>

                    <!-- 属性面板 -->
                    <div class="property-panel">
                        <h3><i class="fas fa-cog"></i> 节点属性</h3>
                        <div id="nodeProperties">
                            <div class="no-selection">
                                <i class="fas fa-mouse-pointer"></i>
                                <p>选择一个节点来编辑属性</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 模态框 -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>登录 TavernAI Plus</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label>邮箱:</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label>密码:</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">登录</button>
                        <button type="button" class="btn btn-secondary" id="showRegisterBtn">注册账号</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="registerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>注册账号</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="registerForm">
                    <div class="form-group">
                        <label>用户名:</label>
                        <input type="text" id="registerUsername" required>
                    </div>
                    <div class="form-group">
                        <label>邮箱:</label>
                        <input type="email" id="registerEmail" required>
                    </div>
                    <div class="form-group">
                        <label>密码:</label>
                        <input type="password" id="registerPassword" required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">注册</button>
                        <button type="button" class="btn btn-secondary" id="showLoginBtn">已有账号</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- AI助手模态框 -->
    <div id="aiAssistantModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3><i class="fas fa-robot"></i> AI工作流助手</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="ai-chat">
                    <div class="chat-messages" id="aiChatMessages"></div>
                    <div class="chat-input">
                        <input type="text" id="aiChatInput" placeholder="描述你想创建的工作流...">
                        <button class="btn btn-primary" id="sendAiMessageBtn">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 加载遮罩 -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>加载中...</p>
        </div>
    </div>

    <!-- JavaScript库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.6/vis-network.min.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/workflow-editor.js"></script>
    <script src="js/main.js"></script>
</body>
</html>