<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>调试诊断页面</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        .info { color: blue; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>TavernAI Plus 调试诊断</h1>
    <div id="results"></div>

    <h2>手动测试</h2>
    <button onclick="testViteModules()">测试Vite模块加载</button>
    <button onclick="testVueApp()">测试Vue应用</button>
    <button onclick="checkRoutes()">检查路由</button>

    <script type="module">
        const log = (message, type = 'info') => {
            const results = document.getElementById('results');
            results.innerHTML += `<div class="${type}">${new Date().toLocaleTimeString()} - ${message}</div>`;
        };

        // 检查基本服务
        log('开始诊断...', 'info');

        // 1. 检查Vite开发服务器
        fetch('/@vite/client')
            .then(r => r.text())
            .then(() => log('✅ Vite开发服务器正常', 'success'))
            .catch(e => log('❌ Vite开发服务器异常: ' + e.message, 'error'));

        // 2. 检查主入口文件
        fetch('/src/main.ts')
            .then(r => r.text())
            .then(text => {
                if (text.includes('createApp')) {
                    log('✅ main.ts 文件加载正常', 'success');
                }
            })
            .catch(e => log('❌ main.ts 加载失败: ' + e.message, 'error'));

        // 3. 检查Vue应用
        import('/src/main.ts').then(() => {
            log('✅ Vue应用模块导入成功', 'success');

            // 检查DOM
            setTimeout(() => {
                const app = document.querySelector('#app');
                if (app) {
                    log('✅ #app容器存在', 'success');
                    if (app.innerHTML.trim()) {
                        log('✅ Vue应用已渲染内容', 'success');
                    } else {
                        log('⚠️ #app容器为空，Vue应用可能未正确挂载', 'warning');
                    }
                } else {
                    log('❌ 未找到#app容器', 'error');
                }
            }, 1000);
        }).catch(e => {
            log('❌ Vue应用导入失败: ' + e.message + '\n' + e.stack, 'error');
        });

        // 4. 检查路由
        import('/src/router/index.ts').then(module => {
            log('✅ 路由模块加载成功', 'success');
            if (module.default) {
                log(`✅ 路由实例存在`, 'success');
            }
        }).catch(e => {
            log('❌ 路由加载失败: ' + e.message, 'error');
        });

        // 5. 检查stores
        import('/src/stores/user.ts').then(() => {
            log('✅ User Store 加载成功', 'success');
        }).catch(e => {
            log('❌ User Store 加载失败: ' + e.message, 'error');
        });

        import('/src/stores/theme.ts').then(() => {
            log('✅ Theme Store 加载成功', 'success');
        }).catch(e => {
            log('❌ Theme Store 加载失败: ' + e.message, 'error');
        });

        // 全局函数
        window.testViteModules = async function() {
            try {
                const modules = [
                    '/node_modules/.vite/deps/vue.js',
                    '/node_modules/.vite/deps/vue-router.js',
                    '/node_modules/.vite/deps/pinia.js'
                ];

                for (const mod of modules) {
                    try {
                        await fetch(mod);
                        log(`✅ 模块 ${mod} 可访问`, 'success');
                    } catch (e) {
                        log(`❌ 模块 ${mod} 不可访问`, 'error');
                    }
                }
            } catch (e) {
                log('测试失败: ' + e.message, 'error');
            }
        };

        window.testVueApp = function() {
            const script = document.createElement('script');
            script.type = 'module';
            script.textContent = `
                import { createApp } from 'vue';
                console.log('Vue import successful');
                window.__vueLoaded = true;
            `;
            document.body.appendChild(script);

            setTimeout(() => {
                if (window.__vueLoaded) {
                    log('✅ Vue框架加载成功', 'success');
                } else {
                    log('❌ Vue框架加载失败', 'error');
                }
            }, 500);
        };

        window.checkRoutes = async function() {
            try {
                const router = await import('/src/router/index.ts');
                const routes = router.default.getRoutes();
                log(`✅ 找到 ${routes.length} 个路由`, 'success');
                routes.forEach(r => {
                    log(`  - ${r.path}: ${r.name}`, 'info');
                });
            } catch (e) {
                log('❌ 无法获取路由信息: ' + e.message, 'error');
            }
        };
    </script>
</body>
</html>
