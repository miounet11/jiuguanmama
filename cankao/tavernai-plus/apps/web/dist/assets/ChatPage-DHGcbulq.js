import{d as D,r as v,x as F,o as T,c as r,a as n,b as e,f,F as w,i as y,p as z,v as V,t as i,y as A,m as _,u as N}from"./index-Dgends3d.js";import{i as d}from"./axios-DIbbNOPG.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"min-h-screen bg-gray-100"},q={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},E={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},Q=["onClick"],R={class:"p-4"},U={class:"flex items-start space-x-3"},G=["src","alt"],I={class:"flex-1 min-w-0"},J={class:"font-semibold text-gray-900 truncate"},K={class:"text-sm text-gray-500"},O={class:"text-sm text-gray-600 mt-1 line-clamp-2"},W={key:0,class:"bg-red-500 text-white text-xs rounded-full px-2 py-1"},X={class:"px-4 py-2 bg-gray-50 border-t flex justify-between items-center"},Y={class:"text-xs text-gray-500"},Z={class:"flex space-x-2"},ee=["onClick"],te=["onClick"],se={key:0,class:"text-center py-12 bg-white rounded-lg mt-6"},ae={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},oe={class:"bg-white rounded-lg max-w-2xl w-full max-h-[80vh] overflow-hidden"},re={class:"p-4 overflow-y-auto max-h-[60vh]"},ne={class:"grid grid-cols-2 sm:grid-cols-3 gap-4"},ie=["onClick"],le=["src","alt"],de={class:"font-medium text-sm truncate"},ce={class:"text-xs text-gray-500 truncate"},ue={class:"p-4 border-t flex justify-end"},he=D({__name:"ChatPage",setup(ve){const g=N(),o=v([]),c=v(!1),u=v(""),h=v([]),b=F(()=>{if(!u.value)return h.value;const a=u.value.toLowerCase();return h.value.filter(t=>t.name.toLowerCase().includes(a)||t.creator.toLowerCase().includes(a))}),C=a=>{const s=new Date().getTime()-new Date(a).getTime(),l=Math.floor(s/1e3),m=Math.floor(l/60),p=Math.floor(m/60),x=Math.floor(p/24);return x>0?`${x}天前`:p>0?`${p}小时前`:m>0?`${m}分钟前`:"刚刚"},k=async()=>{try{const a=await d.get("/api/chats");o.value=a.data}catch(a){console.error("Failed to fetch chats:",a),o.value=[{id:"chat1",character:{id:"char1",name:"助手小明",avatar:""},lastMessage:"好的，我明白了。还有什么可以帮助你的吗？",lastMessageTime:new Date(Date.now()-36e5),messageCount:15,unreadCount:2,isPinned:!0},{id:"chat2",character:{id:"char2",name:"知识导师",avatar:""},lastMessage:"这个问题很有趣，让我详细解释一下...",lastMessageTime:new Date(Date.now()-72e5),messageCount:8,unreadCount:0,isPinned:!1}]}},M=async()=>{try{const a=await d.get("/api/characters");h.value=a.data.characters}catch(a){console.error("Failed to fetch characters:",a),h.value=[{id:"c1",name:"助手小明",avatar:"",creator:"系统"},{id:"c2",name:"知识导师",avatar:"",creator:"系统"},{id:"c3",name:"创意伙伴",avatar:"",creator:"用户A"},{id:"c4",name:"语言老师",avatar:"",creator:"用户B"}]}},$=()=>{c.value=!0,M()},L=async a=>{try{const t=await d.post("/api/chats",{characterId:a.id});g.push(`/chat/${t.data.id}`)}catch(t){console.error("Failed to create chat:",t),g.push(`/chat/new?characterId=${a.id}`)}c.value=!1},P=a=>{g.push(`/chat/${a}`)},j=async a=>{const t=o.value.find(s=>s.id===a);if(t){t.isPinned=!t.isPinned;try{await d.patch(`/api/chats/${a}`,{isPinned:t.isPinned})}catch(s){console.error("Failed to pin chat:",s)}}},B=async a=>{if(confirm("确定要删除这个对话吗？"))try{await d.delete(`/api/chats/${a}`),o.value=o.value.filter(t=>t.id!==a)}catch(t){console.error("Failed to delete chat:",t),o.value=o.value.filter(s=>s.id!==a)}};return T(()=>{k()}),(a,t)=>(n(),r("div",H,[e("div",q,[t[6]||(t[6]=e("h1",{class:"text-2xl font-bold mb-6"},"我的对话",-1)),e("div",E,[e("div",{onClick:$,class:"bg-white rounded-lg shadow hover:shadow-lg transition-shadow cursor-pointer p-6 border-2 border-dashed border-gray-300 hover:border-indigo-500 flex flex-col items-center justify-center"},[...t[2]||(t[2]=[e("svg",{class:"w-12 h-12 text-gray-400 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("span",{class:"text-gray-600 font-medium"},"开始新对话",-1)])]),(n(!0),r(w,null,y(o.value,s=>(n(),r("div",{key:s.id,onClick:l=>P(s.id),class:"bg-white rounded-lg shadow hover:shadow-lg transition-shadow cursor-pointer overflow-hidden"},[e("div",R,[e("div",U,[e("img",{src:s.character.avatar||"/default-avatar.png",alt:s.character.name,class:"w-12 h-12 rounded-full"},null,8,G),e("div",I,[e("h3",J,i(s.character.name),1),e("p",K,i(C(s.lastMessageTime)),1),e("p",O,i(s.lastMessage),1)]),s.unreadCount>0?(n(),r("div",W,i(s.unreadCount),1)):f("",!0)])]),e("div",X,[e("span",Y,i(s.messageCount)+" 条消息",1),e("div",Z,[e("button",{onClick:_(l=>j(s.id),["stop"]),class:A(["p-1 rounded hover:bg-gray-200",s.isPinned?"text-indigo-600":"text-gray-400"])},[...t[3]||(t[3]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M11.414 10l6.293-6.293a1 1 0 00-1.414-1.414L10 8.586 3.707 2.293a1 1 0 00-1.414 1.414L8.586 10l-6.293 6.293a1 1 0 101.414 1.414L10 11.414l6.293 6.293a1 1 0 001.414-1.414L11.414 10z"})],-1)])],10,ee),e("button",{onClick:_(l=>B(s.id),["stop"]),class:"p-1 rounded hover:bg-gray-200 text-gray-400 hover:text-red-600"},[...t[4]||(t[4]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,te)])])],8,Q))),128))]),o.value.length===0?(n(),r("div",se,[...t[5]||(t[5]=[e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1),e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"还没有对话",-1),e("p",{class:"mt-1 text-sm text-gray-500"},'点击上方"开始新对话"创建你的第一个对话',-1)])])):f("",!0)]),c.value?(n(),r("div",ae,[e("div",oe,[t[7]||(t[7]=e("div",{class:"p-6 border-b"},[e("h2",{class:"text-xl font-semibold"},"选择角色")],-1)),e("div",re,[z(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>u.value=s),type:"text",placeholder:"搜索角色...",class:"w-full px-4 py-2 border rounded-lg mb-4"},null,512),[[V,u.value]]),e("div",ne,[(n(!0),r(w,null,y(b.value,s=>(n(),r("div",{key:s.id,onClick:l=>L(s),class:"cursor-pointer hover:bg-gray-50 rounded-lg p-3 border hover:border-indigo-500 transition"},[e("img",{src:s.avatar||"/default-avatar.png",alt:s.name,class:"w-full h-24 object-cover rounded mb-2"},null,8,le),e("p",de,i(s.name),1),e("p",ce,i(s.creator),1)],8,ie))),128))])]),e("div",ue,[e("button",{onClick:t[1]||(t[1]=s=>c.value=!1),class:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300"}," 取消 ")])])])):f("",!0)]))}}),fe=S(he,[["__scopeId","data-v-7e564983"]]);export{fe as default};
