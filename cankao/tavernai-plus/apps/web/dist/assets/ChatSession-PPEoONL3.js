import{d as V,r as u,l as B,o as N,A as R,c as p,a as v,b as e,t as m,p as y,z,v as h,f as w,F,i as $,e as A,B as G,m as I,s as K,C as O,y as _}from"./index-Dgends3d.js";import{i as D}from"./axios-DIbbNOPG.js";const E={class:"flex h-screen bg-gray-100"},P={class:"w-80 bg-white border-r flex flex-col"},H={class:"p-4 border-b"},J={class:"flex items-center space-x-3"},q=["src","alt"],Q={class:"flex-1"},W={class:"font-semibold"},X={class:"text-sm text-gray-500"},Y={class:"flex-1 overflow-y-auto p-4"},Z={class:"space-y-4"},ee={class:"block text-sm font-medium text-gray-700 mb-1"},te={class:"block text-sm font-medium text-gray-700 mb-1"},se={class:"flex-1 flex flex-col"},ae={key:0,class:"text-center text-gray-500 mt-8"},oe={class:"whitespace-pre-wrap"},le={key:1,class:"flex justify-start mb-4"},ne={class:"border-t bg-white p-4"},re={class:"flex space-x-2"},ie=["onKeydown"],de={class:"flex flex-col space-y-2"},ce=["disabled"],me=V({__name:"ChatSession",setup(ue){const k=K(),i=u(null),l=u([]),d=u(""),c=u(!1),g=u(!1),x=u(),r=B({model:"gpt-3.5-turbo",temperature:.7,maxTokens:1e3}),M=a=>new Date(a).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),b=()=>{O(()=>{x.value&&(x.value.scrollTop=x.value.scrollHeight)})},C=async()=>{if(!d.value.trim()||c.value)return;const a={id:Date.now().toString(),role:"user",content:d.value,timestamp:new Date};l.value.push(a);const t=d.value;d.value="",b(),c.value=!0,g.value=!0;try{const o=await D.post(`/api/chats/${k.params.sessionId}/messages`,{content:t,settings:r});g.value=!1;const n={id:o.data.id,role:"assistant",content:o.data.content,timestamp:new Date(o.data.timestamp)};l.value.push(n),b()}catch(o){console.error("Failed to send message:",o),g.value=!1,setTimeout(()=>{const n={id:Date.now().toString(),role:"assistant",content:"抱歉，我现在无法响应。请稍后再试。",timestamp:new Date};l.value.push(n),b()},1e3)}finally{c.value=!1}},S=()=>{c.value=!1,g.value=!1},U=()=>{var f;const a={character:i.value,messages:l.value,exportedAt:new Date},t=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),o=URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.download=`chat-${(f=i.value)==null?void 0:f.name}-${Date.now()}.json`,n.click(),URL.revokeObjectURL(o)},j=()=>{confirm("确定要清空所有对话吗？")&&(l.value=[])},L=async()=>{try{const a=await D.get(`/api/chats/${k.params.sessionId}`);i.value=a.data.character,l.value=a.data.messages}catch(a){console.error("Failed to fetch chat data:",a),i.value={name:"助手",avatar:"",creator:"系统"},l.value=[]}};return N(()=>{L()}),R(l,()=>{b()}),(a,t)=>{var o,n,f,T;return v(),p("div",E,[e("div",P,[e("div",H,[e("div",J,[e("img",{src:((o=i.value)==null?void 0:o.avatar)||"/default-avatar.png",alt:(n=i.value)==null?void 0:n.name,class:"w-12 h-12 rounded-full"},null,8,q),e("div",Q,[e("h2",W,m((f=i.value)==null?void 0:f.name),1),e("p",X,m((T=i.value)==null?void 0:T.creator),1)])])]),e("div",Y,[e("div",Z,[e("div",null,[t[5]||(t[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"AI模型",-1)),y(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>r.model=s),class:"w-full px-3 py-2 border rounded-lg"},[...t[4]||(t[4]=[e("option",{value:"gpt-3.5-turbo"},"GPT-3.5 Turbo",-1),e("option",{value:"gpt-4"},"GPT-4",-1),e("option",{value:"claude-2"},"Claude 2",-1)])],512),[[z,r.model]])]),e("div",null,[e("label",ee," 创造性 ("+m(r.temperature)+") ",1),y(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>r.temperature=s),type:"range",min:"0",max:"2",step:"0.1",class:"w-full"},null,512),[[h,r.temperature]])]),e("div",null,[e("label",te," 最大长度 ("+m(r.maxTokens)+") ",1),y(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>r.maxTokens=s),type:"range",min:"100",max:"4000",step:"100",class:"w-full"},null,512),[[h,r.maxTokens]])])])]),e("div",{class:"p-4 border-t space-y-2"},[e("button",{onClick:U,class:"w-full px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"}," 导出对话 "),e("button",{onClick:j,class:"w-full px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200"}," 清空对话 ")])]),e("div",se,[e("div",{ref_key:"messagesContainer",ref:x,class:"flex-1 overflow-y-auto p-4"},[l.value.length===0?(v(),p("div",ae,[...t[6]||(t[6]=[e("p",null,"开始你的对话吧！",-1)])])):w("",!0),(v(!0),p(F,null,$(l.value,s=>(v(),p("div",{key:s.id,class:"mb-4"},[e("div",{class:_(["flex",s.role==="user"?"justify-end":"justify-start"])},[e("div",{class:_(["max-w-[70%] rounded-lg px-4 py-2",s.role==="user"?"bg-indigo-600 text-white":"bg-white border"])},[e("div",oe,m(s.content),1),e("div",{class:_(["text-xs mt-1",s.role==="user"?"text-indigo-200":"text-gray-400"])},m(M(s.timestamp)),3)],2)],2)]))),128)),g.value?(v(),p("div",le,[...t[7]||(t[7]=[A('<div class="bg-white border rounded-lg px-4 py-2"><div class="flex space-x-1"><div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div><div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay:0.1s;"></div><div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay:0.2s;"></div></div></div>',1)])])):w("",!0)],512),e("div",ne,[e("div",re,[y(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=s=>d.value=s),onKeydown:G(I(C,["prevent"]),["enter"]),placeholder:"输入消息...",class:"flex-1 px-4 py-2 border rounded-lg resize-none",rows:"3"},null,40,ie),[[h,d.value]]),e("div",de,[e("button",{onClick:C,disabled:!d.value.trim()||c.value,class:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50"}," 发送 ",8,ce),c.value?(v(),p("button",{key:0,onClick:S,class:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700"}," 停止 ")):w("",!0)])])])])])}}});export{me as default};
