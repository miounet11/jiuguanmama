import{d as Q,k as X,r as d,o as Y,c as r,a as i,b as t,t as l,j as b,y as L,f as A,F as u,i as v,p as Z,v as tt,s as et,u as st}from"./index-Dgends3d.js";import{i as m}from"./axios-DIbbNOPG.js";const at={class:"min-h-screen bg-gray-50"},ot={class:"bg-gradient-to-r from-purple-600 to-pink-600 text-white"},lt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12"},rt={class:"flex flex-col md:flex-row items-center gap-8"},it={class:"w-48 h-48 rounded-full overflow-hidden bg-white/20 backdrop-blur"},nt=["src","alt"],dt={key:1,class:"w-full h-full flex items-center justify-center bg-gradient-to-br from-purple-400 to-pink-400"},ct={class:"text-6xl font-bold text-white"},ut={class:"flex-1 text-center md:text-left"},vt={class:"text-4xl font-bold mb-2"},pt={class:"text-xl opacity-90 mb-4"},ht={class:"flex flex-wrap gap-6 justify-center md:justify-start mb-6"},mt={class:"text-2xl font-bold"},gt={class:"text-2xl font-bold"},xt={class:"text-2xl font-bold flex items-center"},ft={class:"flex flex-wrap gap-4 justify-center md:justify-start"},_t={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},yt={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},bt={class:"lg:col-span-2 space-y-6"},wt={class:"bg-white rounded-lg shadow p-6"},kt={class:"text-gray-700 whitespace-pre-wrap"},Ct={class:"bg-white rounded-lg shadow p-6"},Lt={class:"space-y-4"},At={class:"flex flex-wrap gap-2"},Mt={key:0},$t={class:"text-gray-600"},Bt={key:1},jt={class:"p-4 bg-gray-50 rounded-lg"},Ft={class:"text-gray-700 italic"},zt={class:"bg-white rounded-lg shadow p-6"},Rt={class:"space-y-4"},Dt={class:"flex items-start justify-between mb-2"},St={class:"flex items-center"},Tt=["src"],It={class:"font-medium"},Nt={class:"flex items-center"},Vt={class:"flex"},Ot={class:"ml-2 text-sm text-gray-500"},Ut={class:"text-gray-700"},Wt={key:0,class:"mt-6 pt-6 border-t"},Et={class:"flex items-center mb-3"},Kt={class:"flex"},qt=["onClick"],Gt={class:"space-y-6"},Ht={class:"bg-white rounded-lg shadow p-6"},Jt={class:"flex flex-wrap gap-2"},Pt={class:"bg-white rounded-lg shadow p-6"},Qt={class:"space-y-3"},Xt=["onClick"],Yt=["src"],Zt={class:"flex-1"},te={class:"font-medium"},ee={class:"text-sm text-gray-500"},se={class:"bg-white rounded-lg shadow p-6"},ae={class:"space-y-3"},oe=["onClick"],le=["src"],re={class:"flex-1"},ie={class:"font-medium"},ne={class:"text-sm text-gray-500"},ve=Q({__name:"CharacterDetail",setup(de){const c=et(),g=st(),x=X(),o=d(null),p=d(!1),y=d([]),w=d([]),k=d([]),M=d(!0),f=d(5),h=d(""),C=a=>a>=1e6?(a/1e6).toFixed(1)+"M":a>=1e3?(a/1e3).toFixed(1)+"K":a.toString(),W=async()=>{const a=c.params.id;try{const e=await m.get(`/api/characters/${a}`);o.value=e.data,p.value=e.data.isLiked}catch(e){console.error("Failed to fetch character:",e),o.value={id:a,name:"示例角色",avatar:"",description:"这是一个充满魅力的角色，拥有丰富的背景故事和独特的性格特征。无论是日常对话还是深入交流，都能带给你有趣的体验。",creator:"创作者123",chats:15234,likes:3421,rating:4.5,personality:["友善","幽默","聪明","有同理心"],scenario:"现代都市背景，角色是一位经验丰富的心理咨询师",firstMessage:"你好！很高兴见到你。今天有什么我可以帮助你的吗？",tags:["现代","心理","治愈","日常","专业"]}}},E=async()=>{try{const a=await m.get(`/api/characters/${c.params.id}/reviews`);y.value=a.data}catch{y.value=[{id:1,username:"用户A",userAvatar:"",rating:5,comment:"非常棒的角色！对话自然流畅，个性鲜明。",date:"2024-01-15"},{id:2,username:"用户B",userAvatar:"",rating:4,comment:"很有趣的设定，期待更多互动选项。",date:"2024-01-14"}]}},K=async()=>{try{const a=await m.get(`/api/characters/${c.params.id}/related`);w.value=a.data}catch{w.value=[{id:"r1",name:"相关角色1",avatar:"",chats:8234},{id:"r2",name:"相关角色2",avatar:"",chats:5421}]}},q=async()=>{var a;try{const e=await m.get(`/api/users/${(a=o.value)==null?void 0:a.creatorId}/characters`);k.value=e.data.filter(n=>n.id!==c.params.id)}catch{k.value=[{id:"o1",name:"其他作品1",avatar:"",rating:4.3},{id:"o2",name:"其他作品2",avatar:"",rating:4.7}]}},G=()=>{if(!x.isAuthenticated){g.push("/login?redirect=/chat");return}g.push(`/chat?characterId=${c.params.id}`)},H=async()=>{if(!x.isAuthenticated){g.push("/login");return}try{await m.post(`/api/characters/${c.params.id}/like`),p.value=!p.value,p.value?o.value.likes++:o.value.likes--}catch(a){console.error("Failed to toggle like:",a)}},J=()=>{var e,n;const a=window.location.href;navigator.share?navigator.share({title:(e=o.value)==null?void 0:e.name,text:(n=o.value)==null?void 0:n.description,url:a}):(navigator.clipboard.writeText(a),alert("链接已复制到剪贴板"))},P=async()=>{var a,e;if(!x.isAuthenticated){g.push("/login");return}if(h.value.trim())try{await m.post(`/api/characters/${c.params.id}/reviews`,{rating:f.value,comment:h.value}),y.value.unshift({id:Date.now(),username:(a=x.user)==null?void 0:a.username,userAvatar:(e=x.user)==null?void 0:e.avatar,rating:f.value,comment:h.value,date:new Date().toISOString().split("T")[0]}),h.value="",f.value=5,M.value=!1}catch(n){console.error("Failed to submit review:",n)}},$=a=>{g.push(`/characters/${a}`)};return Y(()=>{W(),E(),K(),q()}),(a,e)=>{var n,B,j,F,z,R,D,S,T,I,N,V,O,U;return i(),r("div",at,[t("div",ot,[t("div",lt,[t("div",rt,[t("div",it,[(n=o.value)!=null&&n.avatar?(i(),r("img",{key:0,src:o.value.avatar,alt:o.value.name,class:"w-full h-full object-cover"},null,8,nt)):(i(),r("div",dt,[t("span",ct,l((j=(B=o.value)==null?void 0:B.name)==null?void 0:j.charAt(0)),1)]))]),t("div",ut,[t("h1",vt,l((F=o.value)==null?void 0:F.name),1),t("p",pt,"创建者: "+l((z=o.value)==null?void 0:z.creator),1),t("div",ht,[t("div",null,[t("div",mt,l(C(((R=o.value)==null?void 0:R.chats)||0)),1),e[1]||(e[1]=t("div",{class:"text-sm opacity-75"},"对话次数",-1))]),t("div",null,[t("div",gt,l(C(((D=o.value)==null?void 0:D.likes)||0)),1),e[2]||(e[2]=t("div",{class:"text-sm opacity-75"},"获赞",-1))]),t("div",null,[t("div",xt,[e[3]||(e[3]=t("svg",{class:"w-6 h-6 text-yellow-300 fill-current mr-1",viewBox:"0 0 20 20"},[t("path",{d:"M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"})],-1)),b(" "+l((T=(S=o.value)==null?void 0:S.rating)==null?void 0:T.toFixed(1)),1)]),e[4]||(e[4]=t("div",{class:"text-sm opacity-75"},"评分",-1))])]),t("div",ft,[t("button",{onClick:G,class:"px-6 py-3 bg-white text-purple-600 rounded-lg font-semibold hover:bg-gray-100 transition"}," 开始对话 "),t("button",{onClick:H,class:L(["px-6 py-3 rounded-lg font-semibold transition",p.value?"bg-pink-500 text-white hover:bg-pink-600":"bg-white/20 text-white hover:bg-white/30"])},[e[5]||(e[5]=t("svg",{class:"w-5 h-5 inline mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"})],-1)),b(" "+l(p.value?"已收藏":"收藏"),1)],2),t("button",{onClick:J,class:"px-6 py-3 bg-white/20 text-white rounded-lg font-semibold hover:bg-white/30 transition"},[...e[6]||(e[6]=[t("svg",{class:"w-5 h-5 inline mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m9.032 4.026a9.001 9.001 0 01-7.432 0m9.032-4.026A9.001 9.001 0 0112 3c-4.474 0-8.268 3.12-9.032 7.326m0 0A9.001 9.001 0 0012 21c4.474 0 8.268-3.12 9.032-7.326"})],-1),b(" 分享 ",-1)])])])])])])]),t("div",_t,[t("div",yt,[t("div",bt,[t("div",wt,[e[7]||(e[7]=t("h2",{class:"text-xl font-semibold mb-4"},"角色介绍",-1)),t("p",kt,l((I=o.value)==null?void 0:I.description),1)]),t("div",Ct,[e[11]||(e[11]=t("h2",{class:"text-xl font-semibold mb-4"},"角色设定",-1)),t("div",Lt,[t("div",null,[e[8]||(e[8]=t("h3",{class:"font-medium text-gray-700 mb-2"},"性格特点",-1)),t("div",At,[(i(!0),r(u,null,v((N=o.value)==null?void 0:N.personality,s=>(i(),r("span",{key:s,class:"px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm"},l(s),1))),128))])]),(V=o.value)!=null&&V.scenario?(i(),r("div",Mt,[e[9]||(e[9]=t("h3",{class:"font-medium text-gray-700 mb-2"},"场景设定",-1)),t("p",$t,l(o.value.scenario),1)])):A("",!0),(O=o.value)!=null&&O.firstMessage?(i(),r("div",Bt,[e[10]||(e[10]=t("h3",{class:"font-medium text-gray-700 mb-2"},"开场白",-1)),t("div",jt,[t("p",Ft,'"'+l(o.value.firstMessage)+'"',1)])])):A("",!0)])]),t("div",zt,[e[16]||(e[16]=t("h2",{class:"text-xl font-semibold mb-4"},"用户评价",-1)),t("div",Rt,[(i(!0),r(u,null,v(y.value,s=>(i(),r("div",{key:s.id,class:"border-b pb-4 last:border-0"},[t("div",Dt,[t("div",St,[t("img",{src:s.userAvatar||"/default-avatar.png",class:"w-10 h-10 rounded-full mr-3"},null,8,Tt),t("div",null,[t("div",It,l(s.username),1),t("div",Nt,[t("div",Vt,[(i(),r(u,null,v(5,_=>t("svg",{key:_,class:L([_<=s.rating?"text-yellow-400":"text-gray-300","w-4 h-4 fill-current"]),viewBox:"0 0 20 20"},[...e[12]||(e[12]=[t("path",{d:"M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"},null,-1)])],2)),64))]),t("span",Ot,l(s.date),1)])])])]),t("p",Ut,l(s.comment),1)]))),128))]),M.value?(i(),r("div",Wt,[e[15]||(e[15]=t("h3",{class:"font-medium mb-3"},"添加您的评价",-1)),t("div",Et,[e[14]||(e[14]=t("span",{class:"mr-3"},"评分:",-1)),t("div",Kt,[(i(),r(u,null,v(5,s=>t("svg",{key:s,onClick:_=>f.value=s,class:L([s<=f.value?"text-yellow-400":"text-gray-300","w-6 h-6 fill-current cursor-pointer hover:text-yellow-400"]),viewBox:"0 0 20 20"},[...e[13]||(e[13]=[t("path",{d:"M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"},null,-1)])],10,qt)),64))])]),Z(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=s=>h.value=s),placeholder:"分享您的使用体验...",class:"w-full p-3 border rounded-lg resize-none",rows:"3"},null,512),[[tt,h.value]]),t("button",{onClick:P,class:"mt-3 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700"}," 提交评价 ")])):A("",!0)])]),t("div",Gt,[t("div",Ht,[e[17]||(e[17]=t("h3",{class:"font-semibold mb-3"},"标签",-1)),t("div",Jt,[(i(!0),r(u,null,v((U=o.value)==null?void 0:U.tags,s=>(i(),r("span",{key:s,class:"px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200 cursor-pointer"}," #"+l(s),1))),128))])]),t("div",Pt,[e[18]||(e[18]=t("h3",{class:"font-semibold mb-3"},"相关角色",-1)),t("div",Qt,[(i(!0),r(u,null,v(w.value,s=>(i(),r("div",{key:s.id,onClick:_=>$(s.id),class:"flex items-center cursor-pointer hover:bg-gray-50 p-2 rounded"},[t("img",{src:s.avatar||"/default-avatar.png",class:"w-12 h-12 rounded-full mr-3"},null,8,Yt),t("div",Zt,[t("div",te,l(s.name),1),t("div",ee,l(C(s.chats))+" 对话",1)])],8,Xt))),128))])]),t("div",se,[e[20]||(e[20]=t("h3",{class:"font-semibold mb-3"},"创建者的其他作品",-1)),t("div",ae,[(i(!0),r(u,null,v(k.value,s=>(i(),r("div",{key:s.id,onClick:_=>$(s.id),class:"flex items-center cursor-pointer hover:bg-gray-50 p-2 rounded"},[t("img",{src:s.avatar||"/default-avatar.png",class:"w-12 h-12 rounded-full mr-3"},null,8,le),t("div",re,[t("div",ie,l(s.name),1),t("div",ne,[e[19]||(e[19]=t("svg",{class:"w-4 h-4 inline text-yellow-400 fill-current",viewBox:"0 0 20 20"},[t("path",{d:"M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"})],-1)),b(" "+l(s.rating.toFixed(1)),1)])])],8,oe))),128))])])])])])])}}});export{ve as default};
