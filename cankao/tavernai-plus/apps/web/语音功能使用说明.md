# TavernAI Plus 语音功能使用说明

## 功能概述

TavernAI Plus 现已集成完整的语音功能，包括语音输入(STT)、语音合成(TTS)和智能语音交互。这些功能为用户提供了更自然和便捷的AI对话体验。

## 主要特性

### 🎤 语音输入 (STT)
- **一键录音**: 点击麦克风按钮开始语音输入
- **实时波形显示**: 录音时显示音频可视化效果
- **自动转录**: 录音完成后自动转换为文字
- **多语言支持**: 支持中文、英文等多种语言识别
- **智能降噪**: 自动减少背景噪音和回声
- **录音质量控制**: 可调节录音质量和最大时长

### 🔊 语音播放 (TTS)
- **文字转语音**: 将AI回复自动转换为自然语音
- **多种语音选择**: 支持不同的语音角色和风格
- **语音参数调节**: 可调节语速、音调、音量等参数
- **角色专属语音**: 为不同AI角色配置专属语音
- **情感和风格**: 支持不同情感表达和说话风格

### 🎛️ 智能交互
- **自动语音回复**: AI回复可自动播放语音
- **语音消息历史**: 记录和管理语音交互历史
- **快捷键支持**: Ctrl+Shift+V 快速开启语音输入
- **移动端优化**: 针对手机和平板设备优化的界面

## 组件架构

### 核心组件

1. **useVoice.ts** - 语音功能核心 Composable
   - 录音控制和状态管理
   - 音频播放和控制
   - 语音合成和识别API调用
   - 语音配置管理
   - 音频缓存和优化

2. **VoiceInput.vue** - 语音输入组件
   - 录音界面和控制
   - 实时音频波形显示
   - 语音转文字功能
   - 录音设置和配置

3. **VoicePlayer.vue** - 语音播放组件
   - 音频播放控制
   - 播放进度和时长显示
   - 音量和速度调节
   - 音频下载功能

4. **TextToSpeech.vue** - 语音合成组件
   - 文本输入和编辑
   - 语音参数配置
   - 批量语音生成
   - 成本估算显示

5. **VoiceSettings.vue** - 语音配置管理
   - 语音配置的创建、编辑、删除
   - 语音参数全局设置
   - 使用统计和成本控制
   - 角色语音绑定

6. **ChatVoiceFeatures.vue** - 聊天语音集成
   - 聊天界面语音功能集成
   - 消息语音播放控制
   - 自动语音回复设置
   - 语音交互历史管理

## 安装和配置

### 1. 依赖安装
```bash
npm install
```

### 2. API配置
在后端配置多模态AI API端点：
```
POST /api/multimodal/voice/synthesize  # 语音合成
POST /api/multimodal/voice/transcribe  # 语音识别
GET  /api/multimodal/voice/profiles    # 获取语音配置
POST /api/multimodal/voice/profiles    # 创建语音配置
```

### 3. 浏览器权限
确保浏览器允许以下权限：
- 麦克风访问权限
- 音频播放权限
- 本地存储权限（用于缓存）

## 使用方法

### 语音输入
1. 在聊天界面点击麦克风按钮
2. 开始说话，系统会显示录音指示器
3. 再次点击停止录音
4. 等待语音转文字完成
5. 确认文本内容并发送

### 语音播放
1. AI回复消息旁会显示播放按钮
2. 点击播放按钮生成并播放语音
3. 可暂停、继续或停止播放
4. 调节音量和播放速度

### 语音配置
1. 进入设置页面的语音配置部分
2. 创建新的语音配置
3. 选择语音提供商、语言和语音
4. 调节语速、音调、音量等参数
5. 试听并保存配置

### 角色语音绑定
1. 在语音配置中选择要绑定的角色
2. 为不同角色设置专属语音
3. 聊天时系统会自动使用对应语音

## 支持的语音提供商

### OpenAI
- **语音**: Alloy, Echo, Fable, Onyx, Nova, Shimmer
- **语言**: 中文、英文等多种语言
- **特点**: 自然流畅，成本适中

### ElevenLabs
- **语音**: 多种高质量语音选择
- **语言**: 主要支持英文，部分支持中文
- **特点**: 音质极佳，情感表达丰富

### Azure Speech
- **语音**: 微软神经网络语音
- **语言**: 支持多种语言和方言
- **特点**: 企业级稳定性，成本较低

### Google Cloud
- **语音**: WaveNet 和 Standard 语音
- **语言**: 全球多种语言支持
- **特点**: 技术先进，语音自然

## 高级功能

### SSML 支持
使用语音合成标记语言进行精细控制：
```xml
<speak>
  <prosody rate="slow" pitch="high">
    这是一个<emphasis>重要</emphasis>的消息。
  </prosody>
  <break time="1s"/>
  请注意听取。
</speak>
```

### 批量语音生成
1. 在语音合成组件中选择批量生成
2. 输入多行文本（每行一个）
3. 选择是否合并为单个音频文件
4. 开始批量生成和下载

### 语音缓存
- 自动缓存生成的语音文件
- 相同文本和配置的语音直接从缓存播放
- 可在设置中清空缓存释放空间

### 成本控制
- 实时显示语音合成成本估算
- 月度使用统计和成本追踪
- 缓存机制减少重复生成成本

## 快捷键

- `Ctrl + Shift + V`: 开启语音输入
- `ESC`: 关闭语音输入对话框
- `Space`: 播放/暂停当前语音（焦点在播放器时）

## 移动端适配

### 触摸优化
- 大按钮设计，便于触摸操作
- 手势支持，滑动调节音量和进度
- 自适应布局，适配不同屏幕尺寸

### 性能优化
- 音频压缩，减少流量消耗
- 懒加载，按需生成语音
- 离线缓存，提升响应速度

## 故障排除

### 常见问题

1. **麦克风无法使用**
   - 检查浏览器麦克风权限
   - 确认设备麦克风正常工作
   - 尝试刷新页面重新授权

2. **语音无法播放**
   - 检查浏览器音频权限
   - 确认设备音量设置
   - 检查网络连接状态

3. **语音识别不准确**
   - 选择正确的识别语言
   - 确保录音环境安静
   - 调整麦克风距离和音量

4. **语音合成失败**
   - 检查API配置和密钥
   - 确认网络连接正常
   - 检查文本长度是否超限

### 性能优化建议

1. **减少API调用**
   - 启用音频缓存
   - 避免重复生成相同内容
   - 合理设置缓存大小

2. **提升响应速度**
   - 选择合适的音频质量
   - 使用CDN加速音频传输
   - 启用流式语音合成

3. **降低成本**
   - 选择成本效益高的提供商
   - 控制语音生成频率
   - 定期清理无用缓存

## API 文档

### 语音合成
```typescript
POST /api/multimodal/voice/synthesize
{
  "text": "要转换的文本",
  "voice": "语音ID",
  "language": "zh-CN",
  "provider": "openai",
  "pitch": 1.0,
  "speed": 1.0,
  "volume": 0.8,
  "options": {
    "ssml": false,
    "emotion": "neutral",
    "style": "conversational"
  }
}
```

### 语音识别
```typescript
POST /api/multimodal/voice/transcribe
FormData: {
  "audio": File,
  "language": "auto"
}
```

### 语音配置
```typescript
GET /api/multimodal/voice/profiles
POST /api/multimodal/voice/profiles
PUT /api/multimodal/voice/profiles/:id
DELETE /api/multimodal/voice/profiles/:id
```

## 更新日志

### v1.0.0 (2024-01-XX)
- ✨ 新增完整的语音输入功能
- ✨ 新增多种语音合成选项
- ✨ 新增语音配置管理
- ✨ 新增聊天语音集成
- ✨ 新增移动端优化
- 🐛 修复了音频播放兼容性问题
- 🎨 优化了用户界面和交互体验

## 技术支持

如果您在使用过程中遇到问题，请：

1. 查看本文档的故障排除部分
2. 检查浏览器控制台错误信息
3. 确认网络连接和API配置
4. 联系技术支持团队

---

**注意**: 语音功能需要现代浏览器支持，建议使用 Chrome 88+、Firefox 85+ 或 Safari 14+ 版本。