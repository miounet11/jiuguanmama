# TavernAI Plus TypeScript å®æ–½è·¯çº¿å›¾

## é¡¹ç›®æ¦‚å†µ

**ç›®æ ‡**: åœ¨5å¤©å†…è§£å†³60+ä¸ªTypeScripté”™è¯¯ï¼Œå»ºç«‹ç±»å‹å®‰å…¨çš„å¼€å‘ç¯å¢ƒ
**å½“å‰çŠ¶æ€**: å‘ç°ä¸»è¦é”™è¯¯é›†ä¸­åœ¨Expressä¸­é—´ä»¶ã€è·¯ç”±å¤„ç†å™¨å’Œç±»å‹å®šä¹‰ä¸ä¸€è‡´
**æˆåŠŸæŒ‡æ ‡**: 0ä¸ªTypeScripté”™è¯¯ã€95%+ç±»å‹è¦†ç›–ç‡ã€å®Œæ•´çš„å‰åç«¯ç±»å‹åŒæ­¥

## è¯¦ç»†å®æ–½è®¡åˆ’

### ç¬¬1å¤©ï¼šåŸºç¡€æ¶æ„å»ºè®¾ ğŸ—ï¸

#### ä¸Šåˆ (09:00-12:00) - å…±äº«ç±»å‹åº“åˆ›å»º
**è´Ÿè´£Agent**: Type Definition Expert + TypeScript Architect

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»º `packages/types` åŒ…ç»“æ„
- [ ] å®ç°æ ¸å¿ƒå®ä½“ç±»å‹ (User, Character, ChatSession, Message)
- [ ] è®¾è®¡ API ç±»å‹æ¥å£ (Request/Response types)
- [ ] å»ºç«‹ Express ç±»å‹æ‰©å±•æ ‡å‡†

**å…³é”®æ–‡ä»¶**:
```
packages/types/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ entities/index.ts      # å®ä½“ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ api/index.ts          # APIæ¥å£ç±»å‹
â”‚   â”œâ”€â”€ api/express.ts        # Expressæ‰©å±•ç±»å‹
â”‚   â””â”€â”€ index.ts              # ç»Ÿä¸€å¯¼å‡º
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰€æœ‰æ ¸å¿ƒå®ä½“ç±»å‹å®šä¹‰å®Œæˆ
- [ ] Expressç±»å‹æ‰©å±•å†²çªè§£å†³æ–¹æ¡ˆç¡®å®š
- [ ] ç±»å‹åŒ…èƒ½è¢«å…¶ä»–åŒ…æ­£ç¡®å¯¼å…¥

#### ä¸‹åˆ (13:00-18:00) - è¿è¡Œæ—¶éªŒè¯æ¡†æ¶
**è´Ÿè´£Agent**: Type Definition Expert

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»º `packages/schemas` åŒ…
- [ ] å®ç° Zod éªŒè¯æ¨¡å¼
- [ ] å»ºç«‹ç±»å‹-schemaåŒæ­¥æœºåˆ¶
- [ ] é…ç½®åŒ…ä¾èµ–å…³ç³»

**å…³é”®è¾“å‡º**:
```typescript
// ç¤ºä¾‹ï¼šç”¨æˆ·éªŒè¯schema
export const UserSchema = z.object({
  id: z.string().uuid(),
  username: z.string().min(3).max(50),
  email: z.string().email(),
  role: z.enum(['USER', 'ADMIN', 'MODERATOR'])
})

export type User = z.infer<typeof UserSchema>
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰€æœ‰å®ä½“ç±»å‹éƒ½æœ‰å¯¹åº”çš„Zod schema
- [ ] ç±»å‹å’Œschemaä¿æŒ100%åŒæ­¥
- [ ] è¿è¡Œæ—¶éªŒè¯æµ‹è¯•é€šè¿‡

---

### ç¬¬2å¤©ï¼šExpressåç«¯é”™è¯¯ä¿®å¤ ğŸ”§

#### ä¸Šåˆ (09:00-12:00) - ä¸­é—´ä»¶ç±»å‹ä¿®å¤
**è´Ÿè´£Agent**: Backend Expert

**é‡ç‚¹ä¿®å¤æ–‡ä»¶**:
1. `apps/api/src/middleware/auth.ts`
   - ç§»é™¤å†²çªçš„AuthRequestæ¥å£å®šä¹‰
   - ä½¿ç”¨æ ‡å‡†åŒ–çš„AuthenticatedRequestç±»å‹
   - ä¿®å¤å…¨å±€ç±»å‹æ‰©å±•å†²çª

2. `apps/api/src/middleware/admin.ts`
   - ä¿®å¤ TS7030 é”™è¯¯ (ç¼ºå°‘è¿”å›å€¼)
   - ä¿®å¤ TS18048 é”™è¯¯ (req.userå¯èƒ½undefined)
   - ç¡®ä¿æ‰€æœ‰ä»£ç è·¯å¾„éƒ½æœ‰è¿”å›å€¼

3. `apps/api/src/middleware/validate.ts`
   - ä¿®å¤ TS7030 é”™è¯¯
   - æ ‡å‡†åŒ–éªŒè¯ä¸­é—´ä»¶ç±»å‹ç­¾å

**å…·ä½“ä¿®å¤ç­–ç•¥**:
```typescript
// æ ‡å‡†åŒ–çš„ä¸­é—´ä»¶ç±»å‹
export const requireAuth: AuthMiddleware = async (req, res, next) => {
  // ç±»å‹å®‰å…¨çš„å®ç°
  if (!req.user) {
    return res.status(401).json({ error: 'Unauthorized' })
  }
  next() // ç¡®ä¿è¿”å›å€¼
}

// ç±»å‹å®‰å…¨çš„å¤„ç†å™¨åŒ…è£…å™¨
export function withAuth<T>(
  handler: AuthRouteHandler<T>
): RouteHandlerWithNext<T> {
  return async (req, res, next) => {
    if (!req.user) {
      return res.status(401).json({ error: 'Unauthorized' })
    }
    return handler(req as AuthenticatedRequest, res)
  }
}
```

#### ä¸‹åˆ (13:00-18:00) - è·¯ç”±å¤„ç†å™¨ä¿®å¤
**è´Ÿè´£Agent**: Backend Expert

**é‡ç‚¹ä¿®å¤æ–‡ä»¶**:
1. `apps/api/src/routes/ai-features.ts`
   - ä¿®å¤ TS2769 é”™è¯¯ (AuthRequestç±»å‹å†²çª)
   - ä½¿ç”¨æ ‡å‡†åŒ–çš„ç±»å‹å®šä¹‰
   - å®ç°ç±»å‹å®‰å…¨çš„è·¯ç”±å¤„ç†å™¨

2. å…¶ä»–è·¯ç”±æ–‡ä»¶ç³»ç»Ÿæ€§æ£€æŸ¥å’Œä¿®å¤

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰€æœ‰ä¸­é—´ä»¶ TypeScript é”™è¯¯ä¿®å¤
- [ ] æ‰€æœ‰è·¯ç”±å¤„ç†å™¨ç±»å‹å®‰å…¨
- [ ] API ç¼–è¯‘æ— é”™è¯¯ (`npm run type-check:api`)

---

### ç¬¬3å¤©ï¼šå‰ç«¯ç±»å‹åŒæ­¥ ğŸ¨

#### ä¸Šåˆ (09:00-12:00) - ç±»å‹å¯¼å…¥é‡æ„
**è´Ÿè´£Agent**: Frontend Expert

**ä»»åŠ¡æ¸…å•**:
- [ ] æ›´æ–° `apps/web/src/types/` ä¸‹çš„ç±»å‹å®šä¹‰
- [ ] ä» `@tavernai/types` å¯¼å…¥å…±äº«ç±»å‹
- [ ] ç§»é™¤é‡å¤çš„ç±»å‹å®šä¹‰
- [ ] ä¿ç•™å‰ç«¯ç‰¹æœ‰çš„ç±»å‹ (å¦‚è¡¨å•ç±»å‹ã€UIçŠ¶æ€ç±»å‹)

**é‡ç‚¹æ–‡ä»¶**:
```typescript
// apps/web/src/types/character.ts - é‡æ„å
export type {
  Character,
  User,
  ChatSession,
  Message
} from '@tavernai/types/entities'

export type {
  Characters,
  APIResponse,
  PaginatedResponse
} from '@tavernai/types/api'

// åªä¿ç•™å‰ç«¯ç‰¹æœ‰ç±»å‹
export interface CharacterFormData {
  // è¡¨å•ç‰¹æœ‰å­—æ®µ
}
```

#### ä¸‹åˆ (13:00-18:00) - Vueç»„ä»¶ç±»å‹å®‰å…¨
**è´Ÿè´£Agent**: Frontend Expert

**ä»»åŠ¡æ¸…å•**:
- [ ] ä¿®å¤Vueç»„ä»¶propså’Œemitsç±»å‹å®šä¹‰
- [ ] ç±»å‹åŒ–Pinia stores
- [ ] æ›´æ–°APIæœåŠ¡å®¢æˆ·ç«¯ç±»å‹
- [ ] ä¿®å¤composablesç±»å‹é”™è¯¯

**éªŒæ”¶æ ‡å‡†**:
- [ ] å‰ç«¯ç¼–è¯‘æ— é”™è¯¯ (`npm run type-check:web`)
- [ ] æ‰€æœ‰Vueç»„ä»¶ç±»å‹å®‰å…¨
- [ ] Pinia stores å®Œå…¨ç±»å‹åŒ–

---

### ç¬¬4å¤©ï¼šæ•°æ®åº“ç±»å‹ä¼˜åŒ– ğŸ—„ï¸

#### ä¸Šåˆ (09:00-12:00) - Prismaç±»å‹æ˜ å°„
**è´Ÿè´£Agent**: Database Expert

**ä»»åŠ¡æ¸…å•**:
- [ ] ä¼˜åŒ– Prisma schema è®¾è®¡
- [ ] ç”Ÿæˆç±»å‹å®‰å…¨çš„æ•°æ®åº“æŸ¥è¯¢æ–¹æ³•
- [ ] å®ç° Prisma åˆ° @tavernai/types çš„è‡ªåŠ¨æ˜ å°„
- [ ] å»ºç«‹æ•°æ®åº“æ“ä½œçš„ç±»å‹éªŒè¯

#### ä¸‹åˆ (13:00-18:00) - é›†æˆæµ‹è¯•å’ŒéªŒè¯
**è´Ÿè´£Agent**: QA Expert + TypeScript Architect

**ä»»åŠ¡æ¸…å•**:
- [ ] å…¨é¡¹ç›®ç±»å‹æ£€æŸ¥
- [ ] æ„å»ºæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] æ€§èƒ½å½±å“è¯„ä¼°

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ•´ä¸ªé¡¹ç›® 0 ä¸ª TypeScript é”™è¯¯
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ„å»ºæˆåŠŸ
- [ ] æ€§èƒ½æ— æ˜æ˜¾å›é€€

---

### ç¬¬5å¤©ï¼šè‡ªåŠ¨åŒ–å’Œç›‘æ§ ğŸ“Š

#### ä¸Šåˆ (09:00-12:00) - CI/CDé›†æˆ
**è´Ÿè´£Agent**: QA Expert

**ä»»åŠ¡æ¸…å•**:
- [ ] é…ç½® GitHub Actions ç±»å‹æ£€æŸ¥
- [ ] å»ºç«‹ç±»å‹è¦†ç›–ç‡ç›‘æ§
- [ ] å®ç°è‡ªåŠ¨åŒ–ç±»å‹ç”Ÿæˆè„šæœ¬
- [ ] é…ç½® pre-commit hooks

#### ä¸‹åˆ (13:00-18:00) - æ–‡æ¡£å’ŒåŸ¹è®­
**è´Ÿè´£Agent**: TypeScript Architect

**ä»»åŠ¡æ¸…å•**:
- [ ] ç¼–å†™ç±»å‹å®‰å…¨å¼€å‘æŒ‡å—
- [ ] åˆ›å»ºæœ€ä½³å®è·µæ–‡æ¡£
- [ ] å‡†å¤‡å›¢é˜ŸåŸ¹è®­ææ–™
- [ ] å»ºç«‹é•¿æœŸç»´æŠ¤è®¡åˆ’

---

## é£é™©ç®¡ç†å’Œåº”æ€¥è®¡åˆ’

### é«˜é£é™©é¡¹ç›®

#### é£é™©1: Expressç±»å‹æ‰©å±•å†²çªéš¾ä»¥è§£å†³
**å½±å“**: å¯èƒ½å»¶è¯¯åç«¯ä¿®å¤è¿›åº¦
**ç¼“è§£æªæ–½**: 
- å‡†å¤‡å¤šç§ç±»å‹æ‰©å±•æ–¹æ¡ˆ
- å¦‚éœ€è¦å¯æš‚æ—¶ä½¿ç”¨ any ç±»å‹ï¼Œåç»­ä¸“é—¨è§£å†³
- å»ºç«‹å¿«é€Ÿå›æ»šæœºåˆ¶

#### é£é™©2: å‰åç«¯ç±»å‹åŒæ­¥å¤æ‚åº¦é«˜
**å½±å“**: å¯èƒ½å¯¼è‡´ç±»å‹ä¸ä¸€è‡´
**ç¼“è§£æªæ–½**:
- å»ºç«‹è‡ªåŠ¨åŒ–ç±»å‹åŒæ­¥æ£€æŸ¥
- å®ç°ç±»å‹å˜æ›´çš„å½±å“åˆ†æ
- å‡†å¤‡æ‰‹åŠ¨åŒæ­¥çš„æ ‡å‡†æµç¨‹

#### é£é™©3: Prismaç±»å‹æ˜ å°„æ€§èƒ½é—®é¢˜
**å½±å“**: å¯èƒ½å½±å“æ•°æ®åº“æ“ä½œæ€§èƒ½
**ç¼“è§£æªæ–½**:
- è¿›è¡Œå……åˆ†çš„æ€§èƒ½æµ‹è¯•
- å‡†å¤‡ç±»å‹ä¼˜åŒ–æ–¹æ¡ˆ
- å»ºç«‹æ€§èƒ½ç›‘æ§æœºåˆ¶

### åº”æ€¥é¢„æ¡ˆ

#### åœºæ™¯1: ç±»å‹é”™è¯¯æ•°é‡è¶…å‡ºé¢„æœŸ
**è§¦å‘æ¡ä»¶**: ç¬¬3å¤©ç»“æŸæ—¶ä»æœ‰20+ä¸ªé”™è¯¯
**åº”æ€¥æªæ–½**:
- é‡æ–°è¯„ä¼°é”™è¯¯ä¼˜å…ˆçº§
- è°ƒæ•´Agentä»»åŠ¡åˆ†é…
- è€ƒè™‘åˆ†é˜¶æ®µè§£å†³æ–¹æ¡ˆ

#### åœºæ™¯2: æ€§èƒ½æ˜¾è‘—ä¸‹é™
**è§¦å‘æ¡ä»¶**: ç¼–è¯‘æ—¶é—´å¢åŠ 50%ä»¥ä¸Š
**åº”æ€¥æªæ–½**:
- ç«‹å³å›æ»šæ€§èƒ½å½±å“å¤§çš„ä¿®æ”¹
- é‡æ–°è®¾è®¡ç±»å‹æ¶æ„
- å®æ–½æ¸è¿›å¼ç±»å‹åŒ–ç­–ç•¥

#### åœºæ™¯3: å‰åç«¯ç±»å‹ä¸¥é‡ä¸åŒæ­¥
**è§¦å‘æ¡ä»¶**: APIè°ƒç”¨å‡ºç°ç±»å‹é”™è¯¯
**åº”æ€¥æªæ–½**:
- æš‚åœç›¸å…³åŠŸèƒ½å¼€å‘
- ç´§æ€¥ä¿®å¤ç±»å‹ä¸ä¸€è‡´é—®é¢˜
- å®æ–½ä¸´æ—¶çš„ç±»å‹æ£€æŸ¥æœºåˆ¶

---

## æˆåŠŸæŒ‡æ ‡å’Œç›‘æ§

### æ¯æ—¥æ£€æŸ¥æŒ‡æ ‡

#### ç¬¬1å¤©ç»“æŸ
- [ ] å…±äº«ç±»å‹åº“åŒ…åˆ›å»ºå®Œæˆ
- [ ] æ ¸å¿ƒç±»å‹å®šä¹‰è¦†ç›–ç‡ > 80%
- [ ] è¿è¡Œæ—¶éªŒè¯æ¡†æ¶å°±ç»ª

#### ç¬¬2å¤©ç»“æŸ
- [ ] API TypeScripté”™è¯¯æ•°é‡ < 10ä¸ª
- [ ] æ‰€æœ‰ä¸­é—´ä»¶ç±»å‹å®‰å…¨
- [ ] Expressåº”ç”¨ç¼–è¯‘æˆåŠŸ

#### ç¬¬3å¤©ç»“æŸ
- [ ] å‰ç«¯ TypeScripté”™è¯¯æ•°é‡ < 5ä¸ª
- [ ] å‰åç«¯ç±»å‹åŒæ­¥ç‡ > 95%
- [ ] Vueç»„ä»¶ç±»å‹å®‰å…¨

#### ç¬¬4å¤©ç»“æŸ
- [ ] æ•´ä¸ªé¡¹ç›® TypeScripté”™è¯¯æ•°é‡ = 0
- [ ] æ•°æ®åº“æ“ä½œç±»å‹å®‰å…¨
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡

#### ç¬¬5å¤©ç»“æŸ
- [ ] CI/CDç±»å‹æ£€æŸ¥é€šè¿‡
- [ ] ç±»å‹è¦†ç›–ç‡ > 95%
- [ ] æ–‡æ¡£å’ŒåŸ¹è®­ææ–™å®Œæˆ

### é•¿æœŸç›‘æ§æŒ‡æ ‡

#### è´¨é‡æŒ‡æ ‡
- TypeScripté”™è¯¯æ•°é‡è¶‹åŠ¿
- ç±»å‹è¦†ç›–ç‡å˜åŒ–
- ç¼–è¯‘æ—¶é—´å˜åŒ–
- ä»£ç å¯ç»´æŠ¤æ€§è¯„åˆ†

#### å¼€å‘æ•ˆç‡æŒ‡æ ‡
- æ–°åŠŸèƒ½å¼€å‘ç±»å‹é”™è¯¯ç‡
- ç±»å‹ç›¸å…³bugæ•°é‡
- å¼€å‘è€…ç±»å‹ä½¿ç”¨æ»¡æ„åº¦
- ä»£ç reviewä¸­ç±»å‹é—®é¢˜æ¯”ä¾‹

---

## èµ„æºé…ç½®å’Œæ—¶é—´åˆ†é…

### Agentå·¥ä½œé‡åˆ†é…

| Agent | ç¬¬1å¤© | ç¬¬2å¤© | ç¬¬3å¤© | ç¬¬4å¤© | ç¬¬5å¤© | æ€»è®¡ |
|-------|-------|-------|-------|-------|-------|------|
| TypeScript Architect | 4h | 2h | 2h | 4h | 6h | 18h |
| Type Definition Expert | 8h | 2h | 2h | 2h | 2h | 16h |
| Backend Expert | 0h | 8h | 2h | 2h | 2h | 14h |
| Frontend Expert | 0h | 2h | 8h | 2h | 2h | 14h |
| Database Expert | 0h | 0h | 2h | 6h | 2h | 10h |
| QA Expert | 0h | 0h | 2h | 4h | 6h | 12h |

### å…³é”®ä¾èµ–å…³ç³»

```mermaid
graph TD
    A[å…±äº«ç±»å‹åº“] --> B[Expressä¿®å¤]
    A --> C[å‰ç«¯ç±»å‹åŒæ­¥]
    A --> D[æ•°æ®åº“ç±»å‹æ˜ å°„]
    B --> E[é›†æˆæµ‹è¯•]
    C --> E
    D --> E
    E --> F[CI/CDé…ç½®]
    F --> G[æ–‡æ¡£å’ŒåŸ¹è®­]
```

### å¹¶è¡Œä»»åŠ¡ä¼˜åŒ–

**ç¬¬2å¤©å¹¶è¡Œ**: 
- Backend Expert ä¿®å¤Expressé”™è¯¯
- Type Definition Expert å®Œå–„ç±»å‹å®šä¹‰

**ç¬¬3å¤©å¹¶è¡Œ**:
- Frontend Expert ä¿®å¤Vueé”™è¯¯  
- Backend Expert ç»§ç»­ä¼˜åŒ–APIç±»å‹

**ç¬¬4å¤©å¹¶è¡Œ**:
- Database Expert ä¼˜åŒ–æ•°æ®åº“ç±»å‹
- QA Expert å¼€å§‹é›†æˆæµ‹è¯•

è¿™ä¸ªè¯¦ç»†çš„è·¯çº¿å›¾ç¡®ä¿äº†æ¯ä¸ªAgentéƒ½æœ‰æ˜ç¡®çš„ä»»åŠ¡å’Œæ—¶é—´è¡¨ï¼ŒåŒæ—¶å»ºç«‹äº†å®Œå–„çš„é£é™©ç®¡ç†å’Œè´¨é‡ç›‘æ§æœºåˆ¶ã€‚é€šè¿‡ç§‘å­¦çš„ä»»åŠ¡åˆ†é…å’Œå¹¶è¡Œå¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨5å¤©å†…é«˜æ•ˆåœ°è§£å†³æ‰€æœ‰TypeScriptç±»å‹é—®é¢˜ã€‚